/*! For license information please see exam2.bundle.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const i=t[e],s=e+1<t.length,o=s?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,u=i>>2,h=(3&i)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(l=64)),r.push(n[u],n[h],n[l],n[d])}return r.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let e=0;e<t.length;){const s=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==o||null==a||null==c)throw new r;const u=s<<2|o>>4;if(i.push(u),64!==a){const t=o<<4&240|a>>2;if(i.push(t),64!==c){const t=a<<6&192|c;i.push(t)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const i=function(t){return function(t){const r=e(t);return n.encodeByteArray(r,!0)}(t).replace(/\./g,"")},s=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return n.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},o=()=>{var t;return null===(t=s())||void 0===t?void 0:t.config};class a{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function c(){try{return"object"==typeof indexedDB}catch(t){return!1}}function u(){return new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var t;e((null===(t=i.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}class h extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,h.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,l.prototype.create)}}class l{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,i=this.errors[t],s=i?function(t,e){return t.replace(d,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new h(r,o,n)}}const d=/\{\$([^}]+)}/g;function f(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const n=t[i],s=e[i];if(p(n)&&p(s)){if(!f(n,s))return!1}else if(n!==s)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function p(t){return null!==t&&"object"==typeof t}const g=1e3,m=2,y=144e5,v=.5;function w(t,e=g,n=m){const r=e*Math.pow(n,t),i=Math.round(v*r*(Math.random()-.5)*2);return Math.min(y,r+i)}function b(t){return t&&t._delegate?t._delegate:t}class E{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const T="[DEFAULT]";class I{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new a;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:T})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=T){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=T){return this.instances.has(t)}getOptions(t=T){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(r);return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&t(s,r),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===T?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var r;return n||null}normalizeInstanceIdentifier(t=T){return this.component?this.component.multipleInstances?t:T:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class _{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new I(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const C=[];var S;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(S||(S={}));const A={debug:S.DEBUG,verbose:S.VERBOSE,info:S.INFO,warn:S.WARN,error:S.ERROR,silent:S.SILENT},D=S.INFO,k={[S.DEBUG]:"log",[S.VERBOSE]:"log",[S.INFO]:"info",[S.WARN]:"warn",[S.ERROR]:"error"},N=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),i=k[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${r}]  ${t.name}:`,...n)};class x{constructor(t){this.name=t,this._logLevel=D,this._logHandler=N,this._userLogHandler=null,C.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in S))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?A[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,S.DEBUG,...t),this._logHandler(this,S.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,S.VERBOSE,...t),this._logHandler(this,S.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,S.INFO,...t),this._logHandler(this,S.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,S.WARN,...t),this._logHandler(this,S.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,S.ERROR,...t),this._logHandler(this,S.ERROR,...t)}}const L=(t,e)=>e.some((e=>t instanceof e));let R,M;const O=new WeakMap,P=new WeakMap,F=new WeakMap,V=new WeakMap,U=new WeakMap;let B={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return P.get(t);if("objectStoreNames"===e)return t.objectStoreNames||F.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return q(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function j(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(M||(M=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(z(this),t),q(O.get(this))}:function(...t){return q(e.apply(z(this),t))}:function(t,...n){const r=e.call(z(this),t,...n);return F.set(r,t.sort?t.sort():[t]),q(r)}:(t instanceof IDBTransaction&&function(t){if(P.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",s),t.removeEventListener("abort",s)},i=()=>{e(),r()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",s),t.addEventListener("abort",s)}));P.set(t,e)}(t),L(t,R||(R=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,B):t);var e}function q(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",s)},i=()=>{e(q(t.result)),r()},s=()=>{n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&O.set(e,t)})).catch((()=>{})),U.set(e,t),e}(t);if(V.has(t))return V.get(t);const e=j(t);return e!==t&&(V.set(t,e),U.set(e,t)),e}const z=t=>U.get(t);function K(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=q(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(q(o.result),t.oldVersion,t.newVersion,q(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{s&&t.addEventListener("close",(()=>s())),i&&t.addEventListener("versionchange",(t=>i(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}const H=["get","getKey","getAll","getAllKeys","count"],G=["put","add","delete","clear"],Q=new Map;function W(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(Q.get(e))return Q.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=G.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!H.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),i&&s.done]))[0]};return Q.set(e,s),s}var X;X=B,B={...X,get:(t,e,n)=>W(t,e)||X.get(t,e,n),has:(t,e)=>!!W(t,e)||X.has(t,e)};class Y{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const J="@firebase/app",Z="0.10.5",tt=new x("@firebase/app"),et="@firebase/app-compat",nt="@firebase/analytics-compat",rt="@firebase/analytics",it="@firebase/app-check-compat",st="@firebase/app-check",ot="@firebase/auth",at="@firebase/auth-compat",ct="@firebase/database",ut="@firebase/database-compat",ht="@firebase/functions",lt="@firebase/functions-compat",dt="@firebase/installations",ft="@firebase/installations-compat",pt="@firebase/messaging",gt="@firebase/messaging-compat",mt="@firebase/performance",yt="@firebase/performance-compat",vt="@firebase/remote-config",wt="@firebase/remote-config-compat",bt="@firebase/storage",Et="@firebase/storage-compat",Tt="@firebase/firestore",It="@firebase/vertexai-preview",_t="@firebase/firestore-compat",Ct="firebase",St="[DEFAULT]",At={[J]:"fire-core",[et]:"fire-core-compat",[rt]:"fire-analytics",[nt]:"fire-analytics-compat",[st]:"fire-app-check",[it]:"fire-app-check-compat",[ot]:"fire-auth",[at]:"fire-auth-compat",[ct]:"fire-rtdb",[ut]:"fire-rtdb-compat",[ht]:"fire-fn",[lt]:"fire-fn-compat",[dt]:"fire-iid",[ft]:"fire-iid-compat",[pt]:"fire-fcm",[gt]:"fire-fcm-compat",[mt]:"fire-perf",[yt]:"fire-perf-compat",[vt]:"fire-rc",[wt]:"fire-rc-compat",[bt]:"fire-gcs",[Et]:"fire-gcs-compat",[Tt]:"fire-fst",[_t]:"fire-fst-compat",[It]:"fire-vertex","fire-js":"fire-js",[Ct]:"fire-js-all"},Dt=new Map,kt=new Map,Nt=new Map;function xt(t,e){try{t.container.addComponent(e)}catch(n){tt.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Lt(t){const e=t.name;if(Nt.has(e))return tt.debug(`There were multiple attempts to register component ${e}.`),!1;Nt.set(e,t);for(const e of Dt.values())xt(e,t);for(const e of kt.values())xt(e,t);return!0}function Rt(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}const Mt=new l("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Ot{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new E("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Mt.create("app-deleted",{appName:this._name})}}function Pt(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:St,automaticDataCollectionEnabled:!1},e),i=r.name;if("string"!=typeof i||!i)throw Mt.create("bad-app-name",{appName:String(i)});if(n||(n=o()),!n)throw Mt.create("no-options");const s=Dt.get(i);if(s){if(f(n,s.options)&&f(r,s.config))return s;throw Mt.create("duplicate-app",{appName:i})}const a=new _(i);for(const t of Nt.values())a.addComponent(t);const c=new Ot(n,r,a);return Dt.set(i,c),c}function Ft(t=St){const e=Dt.get(t);if(!e&&t===St&&o())return Pt();if(!e)throw Mt.create("no-app",{appName:t});return e}function Vt(t,e,n){var r;let i=null!==(r=At[t])&&void 0!==r?r:t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const t=[`Unable to register library "${i}" with version "${e}":`];return s&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void tt.warn(t.join(" "))}Lt(new E(`${i}-version`,(()=>({library:i,version:e})),"VERSION"))}const Ut="firebase-heartbeat-database",Bt=1,jt="firebase-heartbeat-store";let qt=null;function $t(){return qt||(qt=K(Ut,Bt,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(jt)}catch(t){console.warn(t)}}}).catch((t=>{throw Mt.create("idb-open",{originalErrorMessage:t.message})}))),qt}async function zt(t,e){try{const n=(await $t()).transaction(jt,"readwrite"),r=n.objectStore(jt);await r.put(e,Kt(t)),await n.done}catch(t){if(t instanceof h)tt.warn(t.message);else{const e=Mt.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});tt.warn(e.message)}}}function Kt(t){return`${t.name}!${t.options.appId}`}class Ht{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Qt(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Gt();if((null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((t=>t.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var t;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=Gt(),{heartbeatsToSend:n,unsentEntries:r}=function(t,e=1024){const n=[];let r=t.slice();for(const i of t){const t=n.find((t=>t.agent===i.agent));if(t){if(t.dates.push(i.date),Wt(n)>e){t.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Wt(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),s=i(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function Gt(){return(new Date).toISOString().substring(0,10)}class Qt{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!c()&&u().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await $t()).transaction(jt),n=await e.objectStore(jt).get(Kt(t));return await e.done,n}catch(t){if(t instanceof h)tt.warn(t.message);else{const e=Mt.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});tt.warn(e.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return zt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return zt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function Wt(t){return i(JSON.stringify({version:2,heartbeats:t})).length}Lt(new E("platform-logger",(t=>new Y(t)),"PRIVATE")),Lt(new E("heartbeat",(t=>new Ht(t)),"PRIVATE")),Vt(J,Z,""),Vt(J,Z,"esm2017"),Vt("fire-js",""),Vt("firebase","10.12.2","app");const Xt="@firebase/installations",Yt="0.6.7",Jt=1e4,Zt=`w:${Yt}`,te="FIS_v2",ee="https://firebaseinstallations.googleapis.com/v1",ne=36e5,re=new l("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function ie(t){return t instanceof h&&t.code.includes("request-failed")}function se({projectId:t}){return`${ee}/projects/${t}/installations`}function oe(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}async function ae(t,e){const n=(await e.json()).error;return re.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function ce({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}async function ue(t){const e=await t();return e.status>=500&&e.status<600?t():e}function he(t){return new Promise((e=>{setTimeout(e,t)}))}const le=/^[cdef][\w-]{21}$/,de="";function fe(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const e=function(t){var e;return(e=t,btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(t);return le.test(e)?e:de}catch(t){return de}}function pe(t){return`${t.appName}!${t.appId}`}const ge=new Map;function me(t,e){const n=pe(t);ye(n,e),function(t,e){const n=(!ve&&"BroadcastChannel"in self&&(ve=new BroadcastChannel("[Firebase] FID Change"),ve.onmessage=t=>{ye(t.data.key,t.data.fid)}),ve);n&&n.postMessage({key:t,fid:e}),0===ge.size&&ve&&(ve.close(),ve=null)}(n,e)}function ye(t,e){const n=ge.get(t);if(n)for(const t of n)t(e)}let ve=null;const we="firebase-installations-database",be=1,Ee="firebase-installations-store";let Te=null;function Ie(){return Te||(Te=K(we,be,{upgrade:(t,e)=>{0===e&&t.createObjectStore(Ee)}})),Te}async function _e(t,e){const n=pe(t),r=(await Ie()).transaction(Ee,"readwrite"),i=r.objectStore(Ee),s=await i.get(n);return await i.put(e,n),await r.done,s&&s.fid===e.fid||me(t,e.fid),e}async function Ce(t){const e=pe(t),n=(await Ie()).transaction(Ee,"readwrite");await n.objectStore(Ee).delete(e),await n.done}async function Se(t,e){const n=pe(t),r=(await Ie()).transaction(Ee,"readwrite"),i=r.objectStore(Ee),s=await i.get(n),o=e(s);return void 0===o?await i.delete(n):await i.put(o,n),await r.done,!o||s&&s.fid===o.fid||me(t,o.fid),o}async function Ae(t){let e;const n=await Se(t.appConfig,(n=>{const r=function(t){return Ne(t||{fid:fe(),registrationStatus:0})}(n),i=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(re.create("app-offline"))};const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=async function(t,e){try{const n=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const r=se(t),i=ce(t),s=e.getImmediate({optional:!0});if(s){const t=await s.getHeartbeatsHeader();t&&i.append("x-firebase-client",t)}const o={fid:n,authVersion:te,appId:t.appId,sdkVersion:Zt},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await ue((()=>fetch(r,a)));if(c.ok){const t=await c.json();return{fid:t.fid||n,registrationStatus:2,refreshToken:t.refreshToken,authToken:oe(t.authToken)}}throw await ae("Create Installation",c)}(t,e);return _e(t.appConfig,n)}catch(n){throw ie(n)&&409===n.customData.serverCode?await Ce(t.appConfig):await _e(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}(t,n);return{installationEntry:n,registrationPromise:r}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:De(t)}:{installationEntry:e}}(t,r);return e=i.registrationPromise,i.installationEntry}));return n.fid===de?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}async function De(t){let e=await ke(t.appConfig);for(;1===e.registrationStatus;)await he(100),e=await ke(t.appConfig);if(0===e.registrationStatus){const{installationEntry:e,registrationPromise:n}=await Ae(t);return n||e}return e}function ke(t){return Se(t,(t=>{if(!t)throw re.create("installation-not-found");return Ne(t)}))}function Ne(t){return 1===(e=t).registrationStatus&&e.registrationTime+Jt<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function xe({appConfig:t,heartbeatServiceProvider:e},n){const r=function(t,{fid:e}){return`${se(t)}/${e}/authTokens:generate`}(t,n),i=function(t,{refreshToken:e}){const n=ce(t);return n.append("Authorization",function(t){return`${te} ${t}`}(e)),n}(t,n),s=e.getImmediate({optional:!0});if(s){const t=await s.getHeartbeatsHeader();t&&i.append("x-firebase-client",t)}const o={installation:{sdkVersion:Zt,appId:t.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await ue((()=>fetch(r,a)));if(c.ok)return oe(await c.json());throw await ae("Generate Auth Token",c)}async function Le(t,e=!1){let n;const r=await Se(t.appConfig,(r=>{if(!Me(r))throw re.create("not-registered");const i=r.authToken;if(!e&&(2===(s=i).requestStatus&&!function(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+ne}(s)))return r;var s;if(1===i.requestStatus)return n=async function(t,e){let n=await Re(t.appConfig);for(;1===n.authToken.requestStatus;)await he(100),n=await Re(t.appConfig);const r=n.authToken;return 0===r.requestStatus?Le(t,e):r}(t,e),r;{if(!navigator.onLine)throw re.create("app-offline");const e=function(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}(r);return n=async function(t,e){try{const n=await xe(t,e),r=Object.assign(Object.assign({},e),{authToken:n});return await _e(t.appConfig,r),n}catch(n){if(!ie(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await _e(t.appConfig,n)}else await Ce(t.appConfig);throw n}}(t,e),e}}));return n?await n:r.authToken}function Re(t){return Se(t,(t=>{if(!Me(t))throw re.create("not-registered");return 1===(e=t.authToken).requestStatus&&e.requestTime+Jt<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t;var e}))}function Me(t){return void 0!==t&&2===t.registrationStatus}function Oe(t){return re.create("missing-app-config-values",{valueName:t})}const Pe="installations";Lt(new E(Pe,(t=>{const e=t.getProvider("app").getImmediate(),n=function(t){if(!t||!t.options)throw Oe("App Configuration");if(!t.name)throw Oe("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw Oe(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e);return{app:e,appConfig:n,heartbeatServiceProvider:Rt(e,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),Lt(new E("installations-internal",(t=>{const e=Rt(t.getProvider("app").getImmediate(),Pe).getImmediate();return{getId:()=>async function(t){const e=t,{installationEntry:n,registrationPromise:r}=await Ae(e);return r?r.catch(console.error):Le(e).catch(console.error),n.fid}(e),getToken:t=>async function(t,e=!1){const n=t;return await async function(t){const{registrationPromise:e}=await Ae(t);e&&await e}(n),(await Le(n,e)).token}(e,t)}}),"PRIVATE")),Vt(Xt,Yt),Vt(Xt,Yt,"esm2017");const Fe="analytics",Ve="firebase_id",Ue="origin",Be=6e4,je="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",qe="https://www.googletagmanager.com/gtag/js",$e=new x("@firebase/analytics"),ze=new l("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function Ke(t){if(!t.startsWith(qe)){const e=ze.create("invalid-gtag-resource",{gtagURL:t});return $e.warn(e.message),""}return t}function He(t){return Promise.all(t.map((t=>t.catch((t=>t)))))}const Ge=30,Qe=new class{constructor(t={},e=1e3){this.throttleMetadata=t,this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}};function We(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function Xe(t,e=Qe,n){const{appId:r,apiKey:i,measurementId:s}=t.options;if(!r)throw ze.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw ze.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Je;return setTimeout((async()=>{a.abort()}),void 0!==n?n:Be),Ye({appId:r,apiKey:i,measurementId:s},o,a,e)}async function Ye(t,{throttleEndTimeMillis:e,backoffCount:n},r,i=Qe){var s;const{appId:o,measurementId:a}=t;try{await function(t,e){return new Promise(((n,r)=>{const i=Math.max(e-Date.now(),0),s=setTimeout(n,i);t.addEventListener((()=>{clearTimeout(s),r(ze.create("fetch-throttle",{throttleEndTimeMillis:e}))}))}))}(r,e)}catch(t){if(a)return $e.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==t?void 0:t.message}]`),{appId:o,measurementId:a};throw t}try{const e=await async function(t){var e;const{appId:n,apiKey:r}=t,i={method:"GET",headers:We(r)},s=je.replace("{app-id}",n),o=await fetch(s,i);if(200!==o.status&&304!==o.status){let t="";try{const n=await o.json();(null===(e=n.error)||void 0===e?void 0:e.message)&&(t=n.error.message)}catch(t){}throw ze.create("config-fetch-failed",{httpStatus:o.status,responseMessage:t})}return o.json()}(t);return i.deleteThrottleMetadata(o),e}catch(e){const c=e;if(!function(t){if(!(t instanceof h&&t.customData))return!1;const e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(c)){if(i.deleteThrottleMetadata(o),a)return $e.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==c?void 0:c.message}]`),{appId:o,measurementId:a};throw e}const u=503===Number(null===(s=null==c?void 0:c.customData)||void 0===s?void 0:s.httpStatus)?w(n,i.intervalMillis,Ge):w(n,i.intervalMillis),l={throttleEndTimeMillis:Date.now()+u,backoffCount:n+1};return i.setThrottleMetadata(o,l),$e.debug(`Calling attemptFetch again in ${u} millis`),Ye(t,l,r,i)}}class Je{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach((t=>t()))}}let Ze,tn;async function en(t,e,n,r,i,s,o){var a;const h=Xe(t);h.then((e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&$e.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${e.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((t=>$e.error(t))),e.push(h);const l=async function(){if(!c())return $e.warn(ze.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await u()}catch(t){return $e.warn(ze.create("indexeddb-unavailable",{errorInfo:null==t?void 0:t.toString()}).message),!1}return!0}().then((t=>t?r.getId():void 0)),[d,f]=await Promise.all([h,l]);(function(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(qe)&&n.src.includes(t))return n;return null})(s)||function(t,e){const n=function(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",e)),n}(0,{createScriptURL:Ke}),r=document.createElement("script"),i=`${qe}?l=${t}&id=${e}`;r.src=n?null==n?void 0:n.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}(s,d.measurementId),tn&&(i("consent","default",tn),tn=void 0),i("js",new Date);const p=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return p[Ue]="firebase",p.update=!0,null!=f&&(p[Ve]=f),i("config",d.measurementId,p),Ze&&(i("set",Ze),Ze=void 0),d.measurementId}class nn{constructor(t){this.app=t}_delete(){return delete rn[this.app.options.appId],Promise.resolve()}}let rn={},sn=[];const on={};let an,cn,un="dataLayer",hn=!1;function ln(t,e,n){!function(){const t=[];if(function(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()&&t.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||t.push("Cookies are not available."),t.length>0){const e=t.map(((t,e)=>`(${e+1}) ${t}`)).join(" "),n=ze.create("invalid-analytics-context",{errorInfo:e});$e.warn(n.message)}}();const r=t.options.appId;if(!r)throw ze.create("no-app-id");if(!t.options.apiKey){if(!t.options.measurementId)throw ze.create("no-api-key");$e.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=rn[r])throw ze.create("already-exists",{id:r});if(!hn){!function(t){let e=[];Array.isArray(window[t])?e=window[t]:window[t]=e}(un);const{wrappedGtag:t,gtagCore:e}=function(t,e,n,r,i){let s=function(...t){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=function(t,e,n,r){return async function(i,...s){try{if("event"===i){const[r,i]=s;await async function(t,e,n,r,i){try{let s=[];if(i&&i.send_to){let t=i.send_to;Array.isArray(t)||(t=[t]);const r=await He(n);for(const n of t){const t=r.find((t=>t.measurementId===n)),i=t&&e[t.appId];if(!i){s=[];break}s.push(i)}}0===s.length&&(s=Object.values(e)),await Promise.all(s),t("event",r,i||{})}catch(t){$e.error(t)}}(t,e,n,r,i)}else if("config"===i){const[i,o]=s;await async function(t,e,n,r,i,s){const o=r[i];try{if(o)await e[o];else{const t=(await He(n)).find((t=>t.measurementId===i));t&&await e[t.appId]}}catch(t){$e.error(t)}t("config",i,s)}(t,e,n,r,i,o)}else if("consent"===i){const[e,n]=s;t("consent",e,n)}else if("get"===i){const[e,n,r]=s;t("get",e,n,r)}else if("set"===i){const[e]=s;t("set",e)}else t(i,...s)}catch(t){$e.error(t)}}}(s,t,e,n),{gtagCore:s,wrappedGtag:window[i]}}(rn,sn,on,un,"gtag");cn=t,an=e,hn=!0}return rn[r]=en(t,sn,on,e,an,un,n),new nn(t)}const dn="@firebase/analytics",fn="0.10.4";Lt(new E(Fe,((t,{options:e})=>ln(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),e)),"PUBLIC")),Lt(new E("analytics-internal",(function(t){try{const e=t.getProvider(Fe).getImmediate();return{logEvent:(t,n,r)=>function(t,e,n,r){t=b(t),async function(t,e,n,r,i){if(i&&i.global)t("event",n,r);else{const i=await e;t("event",n,Object.assign(Object.assign({},r),{send_to:i}))}}(cn,rn[t.app.options.appId],e,n,r).catch((t=>$e.error(t)))}(e,t,n,r)}}catch(t){throw ze.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),Vt(dn,fn),Vt(dn,fn,"esm2017");var pn,gn,mn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},yn={};(function(){var t;function e(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(t,e,n){n||(n=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],i=t.g[2];var s=t.g[3],o=e+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=n+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=n+((o=e+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+i&4294967295,t.g[3]=t.g[3]+s&4294967295}function r(t,e){this.h=e;for(var n=[],r=!0,i=t.length-1;0<=i;i--){var s=0|t[i];r&&s==e||(n[i]=s,r=!1)}this.g=n}!function(t,e){function n(){}n.prototype=e.prototype,t.D=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.C=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}(e,(function(){this.blockSize=-1})),e.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},e.prototype.u=function(t,e){void 0===e&&(e=t.length);for(var r=e-this.blockSize,i=this.B,s=this.h,o=0;o<e;){if(0==s)for(;o<=r;)n(this,t,o),o+=this.blockSize;if("string"==typeof t){for(;o<e;)if(i[s++]=t.charCodeAt(o++),s==this.blockSize){n(this,i),s=0;break}}else for(;o<e;)if(i[s++]=t[o++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=e},e.prototype.v=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.o;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.u(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};var i={};function s(t){return-128<=t&&128>t?function(t,e){var n=i;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=function(t){return new r([0|t],0>t?-1:0)}(t)}(t):new r([0|t],0>t?-1:0)}function o(t){if(isNaN(t)||!isFinite(t))return a;if(0>t)return d(o(-t));for(var e=[],n=1,i=0;t>=n;i++)e[i]=t/n|0,n*=4294967296;return new r(e,0)}var a=s(0),c=s(1),u=s(16777216);function h(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function l(t){return-1==t.h}function d(t){for(var e=t.g.length,n=[],i=0;i<e;i++)n[i]=~t.g[i];return new r(n,~t.h).add(c)}function f(t,e){return t.add(d(e))}function p(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function g(t,e){this.g=t,this.h=e}function m(t,e){if(h(e))throw Error("division by zero");if(h(t))return new g(a,a);if(l(t))return e=m(d(t),e),new g(d(e.g),d(e.h));if(l(e))return e=m(t,d(e)),new g(d(e.g),e.h);if(30<t.g.length){if(l(t)||l(e))throw Error("slowDivide_ only works with positive integers.");for(var n=c,r=e;0>=r.l(t);)n=y(n),r=y(r);var i=v(n,1),s=v(r,1);for(r=v(r,2),n=v(n,2);!h(r);){var u=s.add(r);0>=u.l(t)&&(i=i.add(n),s=u),r=v(r,1),n=v(n,1)}return e=f(t,i.j(e)),new g(i,e)}for(i=a;0<=t.l(e);){for(n=Math.max(1,Math.floor(t.m()/e.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),u=(s=o(n)).j(e);l(u)||0<u.l(t);)u=(s=o(n-=r)).j(e);h(s)&&(s=c),i=i.add(s),t=f(t,u)}return new g(i,t)}function y(t){for(var e=t.g.length+1,n=[],i=0;i<e;i++)n[i]=t.i(i)<<1|t.i(i-1)>>>31;return new r(n,t.h)}function v(t,e){var n=e>>5;e%=32;for(var i=t.g.length-n,s=[],o=0;o<i;o++)s[o]=0<e?t.i(o+n)>>>e|t.i(o+n+1)<<32-e:t.i(o+n);return new r(s,t.h)}(t=r.prototype).m=function(){if(l(this))return-d(this).m();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.i(n);t+=(0<=r?r:4294967296+r)*e,e*=4294967296}return t},t.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(h(this))return"0";if(l(this))return"-"+d(this).toString(t);for(var e=o(Math.pow(t,6)),n=this,r="";;){var i=m(n,e).g,s=((0<(n=f(n,i.j(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(h(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},t.i=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},t.l=function(t){return l(t=f(this,t))?-1:h(t)?0:1},t.abs=function(){return l(this)?d(this):this},t.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0,s=0;s<=e;s++){var o=i+(65535&this.i(s))+(65535&t.i(s)),a=(o>>>16)+(this.i(s)>>>16)+(t.i(s)>>>16);i=a>>>16,o&=65535,a&=65535,n[s]=a<<16|o}return new r(n,-2147483648&n[n.length-1]?-1:0)},t.j=function(t){if(h(this)||h(t))return a;if(l(this))return l(t)?d(this).j(d(t)):d(d(this).j(t));if(l(t))return d(this.j(d(t)));if(0>this.l(u)&&0>t.l(u))return o(this.m()*t.m());for(var e=this.g.length+t.g.length,n=[],i=0;i<2*e;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var s=0;s<t.g.length;s++){var c=this.i(i)>>>16,f=65535&this.i(i),g=t.i(s)>>>16,m=65535&t.i(s);n[2*i+2*s]+=f*m,p(n,2*i+2*s),n[2*i+2*s+1]+=c*m,p(n,2*i+2*s+1),n[2*i+2*s+1]+=f*g,p(n,2*i+2*s+1),n[2*i+2*s+2]+=c*g,p(n,2*i+2*s+2)}for(i=0;i<e;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=e;i<2*e;i++)n[i]=0;return new r(n,0)},t.A=function(t){return m(this,t).h},t.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.i(i)&t.i(i);return new r(n,this.h&t.h)},t.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.i(i)|t.i(i);return new r(n,this.h|t.h)},t.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.i(i)^t.i(i);return new r(n,this.h^t.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,gn=yn.Md5=e,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=o,r.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return d(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=o(Math.pow(n,8)),i=a,s=0;s<e.length;s+=8){var c=Math.min(8,e.length-s),u=parseInt(e.substring(s,s+c),n);8>c?(c=o(Math.pow(n,c)),i=i.j(c).add(o(u))):i=(i=i.j(r)).add(o(u))}return i},pn=yn.Integer=r}).apply(void 0!==mn?mn:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var vn,wn,bn,En,Tn,In,_n,Cn,Sn,An="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Dn={};(function(){var t,e="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){return t==Array.prototype||t==Object.prototype||(t[e]=n.value),t},n=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof An&&An];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(t,r){if(r)t:{var i=n;t=t.split(".");for(var s=0;s<t.length-1;s++){var o=t[s];if(!(o in i))break t;i=i[o]}(r=r(s=i[t=t[t.length-1]]))!=s&&null!=r&&e(i,t,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",(function(t){return t||function(){return function(t,e){t instanceof String&&(t+="");var n=0,r=!1,i={next:function(){if(!r&&n<t.length){var i=n++;return{value:e(0,t[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(t,e){return e}))}}));var r=r||{},i=this||self;function s(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function o(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function a(t,e,n){return t.call.apply(t.bind,arguments)}function c(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function u(t,e,n){return(u=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:c).apply(null,arguments)}function h(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function l(t,e){function n(){}n.prototype=e.prototype,t.aa=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Qb=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}function d(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function f(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(s(n)){const e=t.length||0,r=n.length||0;t.length=e+r;for(let i=0;i<r;i++)t[e+i]=n[i]}else t.push(n)}}function p(t){return/^[\s\xa0]*$/.test(t)}function g(){var t=i.navigator;return t&&(t=t.userAgent)?t:""}function m(t){return m[" "](t),t}m[" "]=function(){};var y=!(-1==g().indexOf("Gecko")||-1!=g().toLowerCase().indexOf("webkit")&&-1==g().indexOf("Edge")||-1!=g().indexOf("Trident")||-1!=g().indexOf("MSIE")||-1!=g().indexOf("Edge"));function v(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function w(t){const e={};for(const n in t)e[n]=t[n];return e}const b="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<b.length;e++)n=b[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function T(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function I(t){i.setTimeout((()=>{throw t}),0)}function _(){var t=k;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var C=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new S),(t=>t.reset()));class S{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}let A,D=!1,k=new class{constructor(){this.h=this.g=null}add(t,e){const n=C.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},N=()=>{const t=i.Promise.resolve(void 0);A=()=>{t.then(x)}};var x=()=>{for(var t;t=_();){try{t.h.call(t.g)}catch(t){I(t)}var e=C;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}D=!1};function L(){this.s=this.s,this.C=this.C}function R(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}L.prototype.s=!1,L.prototype.ma=function(){this.s||(this.s=!0,this.N())},L.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},R.prototype.h=function(){this.defaultPrevented=!0};var M=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};i.addEventListener("test",t,e),i.removeEventListener("test",t,e)}catch(t){}return t}();function O(t,e){if(R.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(y){t:{try{m(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:P[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&O.aa.h.call(this)}}l(O,R);var P={2:"touch",3:"pen",4:"mouse"};O.prototype.h=function(){O.aa.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var F="closure_listenable_"+(1e6*Math.random()|0),V=0;function U(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ha=i,this.key=++V,this.da=this.fa=!1}function B(t){t.da=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function j(t){this.src=t,this.g={},this.h=0}function q(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],s=Array.prototype.indexOf.call(i,e,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(B(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function $(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.da&&s.listener==e&&s.capture==!!n&&s.ha==r)return i}return-1}j.prototype.add=function(t,e,n,r,i){var s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);var o=$(t,e,r,i);return-1<o?(e=t[o],n||(e.fa=!1)):((e=new U(e,this.src,s,!!r,i)).fa=n,t.push(e)),e};var z="closure_lm_"+(1e6*Math.random()|0),K={};function H(t,e,n,r,i){if(r&&r.once)return Q(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)H(t,e[s],n,r,i);return null}return n=et(n),t&&t[F]?t.K(e,n,o(r)?!!r.capture:!!r,i):G(t,e,n,!1,r,i)}function G(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var a=o(i)?!!i.capture:!!i,c=Z(t);if(c||(t[z]=c=new j(t)),(n=c.add(e,n,r,a,s)).proxy)return n;if(r=function(){const t=J;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)M||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Y(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Q(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Q(t,e[s],n,r,i);return null}return n=et(n),t&&t[F]?t.L(e,n,o(r)?!!r.capture:!!r,i):G(t,e,n,!0,r,i)}function W(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)W(t,e[s],n,r,i);else r=o(r)?!!r.capture:!!r,n=et(n),t&&t[F]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=$(s=t.g[e],n,r,i))&&(B(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete t.g[e],t.h--))):t&&(t=Z(t))&&(e=t.g[e.toString()],t=-1,e&&(t=$(e,n,r,i)),(n=-1<t?e[t]:null)&&X(n))}function X(t){if("number"!=typeof t&&t&&!t.da){var e=t.src;if(e&&e[F])q(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Y(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Z(e))?(q(n,t),0==n.h&&(n.src=null,e[z]=null)):B(t)}}}function Y(t){return t in K?K[t]:K[t]="on"+t}function J(t,e){if(t.da)t=!0;else{e=new O(e,this);var n=t.listener,r=t.ha||t.src;t.fa&&X(t),t=n.call(r,e)}return t}function Z(t){return(t=t[z])instanceof j?t:null}var tt="__closure_events_fn_"+(1e9*Math.random()>>>0);function et(t){return"function"==typeof t?t:(t[tt]||(t[tt]=function(e){return t.handleEvent(e)}),t[tt])}function nt(){L.call(this),this.i=new j(this),this.M=this,this.F=null}function rt(t,e){var n,r=t.F;if(r)for(n=[];r;r=r.F)n.push(r);if(t=t.M,r=e.type||e,"string"==typeof e)e=new R(e,t);else if(e instanceof R)e.target=e.target||t;else{var i=e;E(e=new R(r,t),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];i=it(o,r,!0,e)&&i}if(i=it(o=e.g=t,r,!0,e)&&i,i=it(o,r,!1,e)&&i,n)for(s=0;s<n.length;s++)i=it(o=e.g=n[s],r,!1,e)&&i}function it(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.da&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.fa&&q(t.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}function st(t,e,n){if("function"==typeof t)n&&(t=u(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=u(t.handleEvent,t)}return 2147483647<Number(e)?-1:i.setTimeout(t,e||0)}function ot(t){t.g=st((()=>{t.g=null,t.i&&(t.i=!1,ot(t))}),t.l);const e=t.h;t.h=null,t.m.apply(null,e)}l(nt,L),nt.prototype[F]=!0,nt.prototype.removeEventListener=function(t,e,n,r){W(this,t,e,n,r)},nt.prototype.N=function(){if(nt.aa.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)B(n[r]);delete e.g[t],e.h--}}this.F=null},nt.prototype.K=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},nt.prototype.L=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};class at extends L{constructor(t,e){super(),this.m=t,this.l=e,this.h=null,this.i=!1,this.g=null}j(t){this.h=arguments,this.g?this.i=!0:ot(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ct(t){L.call(this),this.h=t,this.g={}}l(ct,L);var ut=[];function ht(t){v(t.g,(function(t,e){this.g.hasOwnProperty(e)&&X(t)}),t),t.g={}}ct.prototype.N=function(){ct.aa.N.call(this),ht(this)},ct.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var lt=i.JSON.stringify,dt=i.JSON.parse,ft=class{stringify(t){return i.JSON.stringify(t,void 0)}parse(t){return i.JSON.parse(t,void 0)}};function pt(){}function gt(t){return t.h||(t.h=t.i())}function mt(){}pt.prototype.h=null;var yt={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function vt(){R.call(this,"d")}function wt(){R.call(this,"c")}l(vt,R),l(wt,R);var bt={},Et=null;function Tt(){return Et=Et||new nt}function It(t){R.call(this,bt.La,t)}function _t(t){const e=Tt();rt(e,new It(e))}function Ct(t,e){R.call(this,bt.STAT_EVENT,t),this.stat=e}function St(t){const e=Tt();rt(e,new Ct(e,t))}function At(t,e){R.call(this,bt.Ma,t),this.size=e}function Dt(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return i.setTimeout((function(){t()}),e)}function kt(){this.g=!0}function Nt(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return lt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}bt.La="serverreachability",l(It,R),bt.STAT_EVENT="statevent",l(Ct,R),bt.Ma="timingevent",l(At,R),kt.prototype.xa=function(){this.g=!1},kt.prototype.info=function(){};var xt,Lt={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Rt={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Mt(){}function Ot(t,e,n,r){this.j=t,this.i=e,this.l=n,this.R=r||1,this.U=new ct(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Pt}function Pt(){this.i=null,this.g="",this.h=!1}l(Mt,pt),Mt.prototype.g=function(){return new XMLHttpRequest},Mt.prototype.i=function(){return{}},xt=new Mt;var Ft={},Vt={};function Ut(t,e,n){t.L=1,t.v=le(oe(e)),t.m=n,t.P=!0,Bt(t,null)}function Bt(t,e){t.F=Date.now(),$t(t),t.A=oe(t.v);var n=t.A,r=t.R;Array.isArray(r)||(r=[String(r)]),Ce(n.i,"t",r),t.C=0,n=t.j.J,t.h=new Pt,t.g=fn(t.j,n?e:null,!t.m),0<t.O&&(t.M=new at(u(t.Y,t,t.g),t.O)),e=t.U,n=t.g,r=t.ca;var i="readystatechange";Array.isArray(i)||(i&&(ut[0]=i.toString()),i=ut);for(var s=0;s<i.length;s++){var o=H(n,i[s],r||e.handleEvent,!1,e.h||e);if(!o)break;e.g[o.key]=o}e=t.H?w(t.H):{},t.m?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.m,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),_t(),function(t,e,n,r,i,s){t.info((function(){if(t.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o}))}(t.i,t.u,t.A,t.l,t.R,t.m)}function jt(t){return!!t.g&&"GET"==t.u&&2!=t.L&&t.j.Ca}function qt(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?Vt:(n=Number(e.substring(n,r)),isNaN(n)?Ft:(r+=1)+n>e.length?Vt:(e=e.slice(r,r+n),t.C=r+n,e))}function $t(t){t.S=Date.now()+t.I,zt(t,t.I)}function zt(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Dt(u(t.ba,t),e)}function Kt(t){t.B&&(i.clearTimeout(t.B),t.B=null)}function Ht(t){0==t.j.G||t.J||cn(t.j,t)}function Gt(t){Kt(t);var e=t.M;e&&"function"==typeof e.ma&&e.ma(),t.M=null,ht(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.ma())}function Qt(t,e){try{var n=t.j;if(0!=n.G&&(n.g==t||Zt(n.h,t)))if(!t.K&&Zt(n.h,t)&&3==n.G){try{var r=n.Da.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;an(n),Xe(n)}rn(n),St(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=Dt(u(n.Za,n),6e3));if(1>=Jt(n.h)&&n.ca){try{n.ca()}catch(t){}n.ca=void 0}}else hn(n,11)}else if((t.K||n.g==t)&&an(n),!p(e))for(i=n.Da.g.parse(e),e=0;e<i.length;e++){let u=i[e];if(n.T=u[0],u=u[1],2==n.G)if("c"==u[0]){n.K=u[1],n.ia=u[2];const e=u[3];null!=e&&(n.la=e,n.j.info("VER="+n.la));const i=u[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=r.h;s.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(te(s,s.h),s.h=null))}if(r.D){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.ya=t,he(r.I,r.D,t))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-t.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=t;if((r=n).qa=dn(r,r.J?r.ia:null,r.W),o.K){ee(r.h,o);var a=o,c=r.L;c&&(a.I=c),a.B&&(Kt(a),$t(a)),r.g=o}else nn(r);0<n.i.length&&Je(n)}else"stop"!=u[0]&&"close"!=u[0]||hn(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?hn(n,7):We(n):"noop"!=u[0]&&n.l&&n.l.ta(u),n.v=0)}_t()}catch(t){}}Ot.prototype.ca=function(t){t=t.target;const e=this.M;e&&3==Ke(t)?e.j():this.Y(t)},Ot.prototype.Y=function(t){try{if(t==this.g)t:{const d=Ke(this.g);var e=this.g.Ba();if(this.g.Z(),!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||He(this.g)))){this.J||4!=d||7==e||_t(),Kt(this);var n=this.g.Z();this.X=n;e:if(jt(this)){var r=He(this.g);t="";var s=r.length,o=4==Ke(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Gt(this),Ht(this);var a="";break e}this.h.i=new i.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:!(o&&e==s-1)});r.length=0,this.h.g+=t,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(t,e,n,r,i,s,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+s+" "+o}))}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){e:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(c)){var h=c;break e}}h=null}if(!(n=h)){this.o=!1,this.s=3,St(12),Gt(this),Ht(this);break t}Nt(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Qt(this,n)}if(this.P){let t;for(n=!0;!this.J&&this.C<a.length;){if(t=qt(this,a),t==Vt){4==d&&(this.s=4,St(14),n=!1),Nt(this.i,this.l,null,"[Incomplete Response]");break}if(t==Ft){this.s=4,St(15),Nt(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}Nt(this.i,this.l,t,null),Qt(this,t)}if(jt(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,St(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var l=this.j;l.g==this&&l.ba&&!l.M&&(l.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),sn(l),l.M=!0,St(11))}}else Nt(this.i,this.l,a,"[Invalid Chunked Response]"),Gt(this),Ht(this)}else Nt(this.i,this.l,a,null),Qt(this,a);4==d&&Gt(this),this.o&&!this.J&&(4==d?cn(this.j,this):(this.o=!1,$t(this)))}else(function(t){const e={};t=(t.g&&2<=Ke(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(p(t[r]))continue;var n=T(t[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=e[i]||[];e[i]=s,s.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,St(12)):(this.s=0,St(13)),Gt(this),Ht(this)}}}catch(t){}},Ot.prototype.cancel=function(){this.J=!0,Gt(this)},Ot.prototype.ba=function(){this.B=null;const t=Date.now();0<=t-this.S?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.i,this.A),2!=this.L&&(_t(),St(17)),Gt(this),this.s=2,Ht(this)):zt(this,this.S-t)};var Wt=class{constructor(t,e){this.g=t,this.map=e}};function Xt(t){this.l=t||10,t=i.PerformanceNavigationTiming?0<(t=i.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Yt(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Jt(t){return t.h?1:t.g?t.g.size:0}function Zt(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function te(t,e){t.g?t.g.add(e):t.h=e}function ee(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function ne(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return d(t.i)}function re(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(s(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.na&&"function"==typeof t.na)return t.na();if(!t.V||"function"!=typeof t.V){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(s(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.V&&"function"==typeof t.V)return t.V();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(s(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}Xt.prototype.cancel=function(){if(this.i=ne(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var ie=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function se(t){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,t instanceof se){this.h=t.h,ae(this,t.j),this.o=t.o,this.g=t.g,ce(this,t.s),this.l=t.l;var e=t.i,n=new Ee;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),ue(this,n),this.m=t.m}else t&&(e=String(t).match(ie))?(this.h=!1,ae(this,e[1]||"",!0),this.o=de(e[2]||""),this.g=de(e[3]||"",!0),ce(this,e[4]),this.l=de(e[5]||"",!0),ue(this,e[6]||"",!0),this.m=de(e[7]||"")):(this.h=!1,this.i=new Ee(null,this.h))}function oe(t){return new se(t)}function ae(t,e,n){t.j=n?de(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function ce(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.s=e}else t.s=null}function ue(t,e,n){e instanceof Ee?(t.i=e,function(t,e){e&&!t.j&&(Te(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Ie(this,e),Ce(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=fe(e,we)),t.i=new Ee(e,t.h))}function he(t,e,n){t.i.set(e,n)}function le(t){return he(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function de(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function fe(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,pe),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function pe(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}se.prototype.toString=function(){var t=[],e=this.j;e&&t.push(fe(e,me,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.o)&&t.push(fe(e,me,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(fe(n,"/"==n.charAt(0)?ve:ye,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.m)&&t.push("#",fe(n,be)),t.join("")};var ge,me=/[#\/\?@]/g,ye=/[#\?:]/g,ve=/[#\?]/g,we=/[#\?@]/g,be=/#/g;function Ee(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Te(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Ie(t,e){Te(t),e=Se(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function _e(t,e){return Te(t),e=Se(t,e),t.g.has(e)}function Ce(t,e,n){Ie(t,e),0<n.length&&(t.i=null,t.g.set(Se(t,e),d(n)),t.h+=n.length)}function Se(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Ae(t,e,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(t){}}function De(){this.g=new ft}function ke(t,e,n){const r=n||"";try{re(t,(function(t,n){let i=t;o(t)&&(i=lt(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function Ne(t){this.l=t.Ub||null,this.j=t.eb||!1}function xe(t,e){nt.call(this),this.D=t,this.o=e,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Le(t){t.j.read().then(t.Pa.bind(t)).catch(t.ga.bind(t))}function Re(t){t.readyState=4,t.l=null,t.j=null,t.v=null,Me(t)}function Me(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Oe(t){let e="";return v(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function Pe(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Oe(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):he(t,e,n))}function Fe(t){nt.call(this),this.headers=new Map,this.o=t||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(t=Ee.prototype).add=function(t,e){Te(this),this.i=null,t=Se(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},t.forEach=function(t,e){Te(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},t.na=function(){Te(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const i=t[r];for(let t=0;t<i.length;t++)n.push(e[r])}return n},t.V=function(t){Te(this);let e=[];if("string"==typeof t)_e(this,t)&&(e=e.concat(this.g.get(Se(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},t.set=function(t,e){return Te(this),this.i=null,_e(this,t=Se(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},t.get=function(t,e){return t&&0<(t=this.V(t)).length?String(t[0]):e},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const s=encodeURIComponent(String(r)),o=this.V(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),t.push(i)}}return this.i=t.join("&")},l(Ne,pt),Ne.prototype.g=function(){return new xe(this.l,this.j)},Ne.prototype.i=(ge={},function(){return ge}),l(xe,nt),(t=xe.prototype).open=function(t,e){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=t,this.A=e,this.readyState=1,Me(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.u,method:this.B,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||i).fetch(new Request(this.A,e)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Re(this)),this.readyState=0},t.Sa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Me(this)),this.g&&(this.readyState=3,Me(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Le(this)}else t.text().then(this.Ra.bind(this),this.ga.bind(this))},t.Pa=function(t){if(this.g){if(this.o&&t.value)this.response.push(t.value);else if(!this.o){var e=t.value?t.value:new Uint8Array(0);(e=this.v.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Re(this):Me(this),3==this.readyState&&Le(this)}},t.Ra=function(t){this.g&&(this.response=this.responseText=t,Re(this))},t.Qa=function(t){this.g&&(this.response=t,Re(this))},t.ga=function(){this.g&&Re(this)},t.setRequestHeader=function(t,e){this.u.append(t,e)},t.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(xe.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}}),l(Fe,nt);var Ve=/^https?$/i,Ue=["POST","PUT"];function Be(t,e){t.h=!1,t.g&&(t.j=!0,t.g.abort(),t.j=!1),t.l=e,t.m=5,je(t),$e(t)}function je(t){t.A||(t.A=!0,rt(t,"complete"),rt(t,"error"))}function qe(t){if(t.h&&void 0!==r&&(!t.v[1]||4!=Ke(t)||2!=t.Z()))if(t.u&&4==Ke(t))st(t.Ea,0,t);else if(rt(t,"readystatechange"),4==Ke(t)){t.h=!1;try{const r=t.Z();t:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var s;if(s=0===r){var o=String(t.D).match(ie)[1]||null;!o&&i.self&&i.self.location&&(o=i.self.location.protocol.slice(0,-1)),s=!Ve.test(o?o.toLowerCase():"")}n=s}if(n)rt(t,"complete"),rt(t,"success");else{t.m=6;try{var a=2<Ke(t)?t.g.statusText:""}catch(t){a=""}t.l=a+" ["+t.Z()+"]",je(t)}}finally{$e(t)}}}function $e(t,e){if(t.g){ze(t);const n=t.g,r=t.v[0]?()=>{}:null;t.g=null,t.v=null,e||rt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function ze(t){t.I&&(i.clearTimeout(t.I),t.I=null)}function Ke(t){return t.g?t.g.readyState:0}function He(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.H){case"":case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Ge(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Qe(t){this.Aa=0,this.i=[],this.j=new kt,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ge("failFast",!1,t),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ge("baseRetryDelayMs",5e3,t),this.cb=Ge("retryDelaySeedMs",1e4,t),this.Wa=Ge("forwardChannelMaxRetries",2,t),this.wa=Ge("forwardChannelRequestTimeoutMs",2e4,t),this.pa=t&&t.xmlHttpFactory||void 0,this.Xa=t&&t.Tb||void 0,this.Ca=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.h=new Xt(t&&t.concurrentRequestLimit),this.Da=new De,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=t&&t.Rb||!1,t&&t.xa&&this.j.xa(),t&&t.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&t&&t.detectBufferingProxy||!1,this.ja=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.ja=t.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function We(t){if(Ye(t),3==t.G){var e=t.U++,n=oe(t.I);if(he(n,"SID",t.K),he(n,"RID",e),he(n,"TYPE","terminate"),tn(t,n),(e=new Ot(t,t.j,e)).L=2,e.v=le(oe(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(e.v.toString(),"")}catch(t){}!n&&i.Image&&((new Image).src=e.v,n=!0),n||(e.g=fn(e.j,null),e.g.ea(e.v)),e.F=Date.now(),$t(e)}ln(t)}function Xe(t){t.g&&(sn(t),t.g.cancel(),t.g=null)}function Ye(t){Xe(t),t.u&&(i.clearTimeout(t.u),t.u=null),an(t),t.h.cancel(),t.s&&("number"==typeof t.s&&i.clearTimeout(t.s),t.s=null)}function Je(t){if(!Yt(t.h)&&!t.s){t.s=!0;var e=t.Ga;A||N(),D||(A(),D=!0),k.add(e,t),t.B=0}}function Ze(t,e){var n;n=e?e.l:t.U++;const r=oe(t.I);he(r,"SID",t.K),he(r,"RID",n),he(r,"AID",t.T),tn(t,r),t.m&&t.o&&Pe(r,t.m,t.o),n=new Ot(t,t.j,n,t.B+1),null===t.m&&(n.H=t.o),e&&(t.i=e.D.concat(t.i)),e=en(t,n,1e3),n.I=Math.round(.5*t.wa)+Math.round(.5*t.wa*Math.random()),te(t.h,n),Ut(n,r,e)}function tn(t,e){t.H&&v(t.H,(function(t,n){he(e,n,t)})),t.l&&re({},(function(t,n){he(e,n,t)}))}function en(t,e,n){n=Math.min(t.i.length,n);var r=t.l?u(t.l.Na,t.l,t):null;t:{var i=t.i;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=i[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=e,0>n)e=Math.max(0,i[o].g-100),s=!1;else try{ke(a,t,"req"+n+"_")}catch(t){r&&r(a)}}if(s){r=t.join("&");break t}}}return t=t.i.splice(0,n),e.D=t,r}function nn(t){if(!t.g&&!t.u){t.Y=1;var e=t.Fa;A||N(),D||(A(),D=!0),k.add(e,t),t.v=0}}function rn(t){return!(t.g||t.u||3<=t.v||(t.Y++,t.u=Dt(u(t.Fa,t),un(t,t.v)),t.v++,0))}function sn(t){null!=t.A&&(i.clearTimeout(t.A),t.A=null)}function on(t){t.g=new Ot(t,t.j,"rpc",t.Y),null===t.m&&(t.g.H=t.o),t.g.O=0;var e=oe(t.qa);he(e,"RID","rpc"),he(e,"SID",t.K),he(e,"AID",t.T),he(e,"CI",t.F?"0":"1"),!t.F&&t.ja&&he(e,"TO",t.ja),he(e,"TYPE","xmlhttp"),tn(t,e),t.m&&t.o&&Pe(e,t.m,t.o),t.L&&(t.g.I=t.L);var n=t.g;t=t.ia,n.L=1,n.v=le(oe(e)),n.m=null,n.P=!0,Bt(n,t)}function an(t){null!=t.C&&(i.clearTimeout(t.C),t.C=null)}function cn(t,e){var n=null;if(t.g==e){an(t),sn(t),t.g=null;var r=2}else{if(!Zt(t.h,e))return;n=e.D,ee(t.h,e),r=1}if(0!=t.G)if(e.o)if(1==r){n=e.m?e.m.length:0,e=Date.now()-e.F;var i=t.B;rt(r=Tt(),new At(r,n)),Je(t)}else nn(t);else if(3==(i=e.s)||0==i&&0<e.X||!(1==r&&function(t,e){return!(Jt(t.h)>=t.h.j-(t.s?1:0)||(t.s?(t.i=e.D.concat(t.i),0):1==t.G||2==t.G||t.B>=(t.Va?0:t.Wa)||(t.s=Dt(u(t.Ga,t,e),un(t,t.B)),t.B++,0)))}(t,e)||2==r&&rn(t)))switch(n&&0<n.length&&(e=t.h,e.i=e.i.concat(n)),i){case 1:hn(t,5);break;case 4:hn(t,10);break;case 3:hn(t,6);break;default:hn(t,2)}}function un(t,e){let n=t.Ta+Math.floor(Math.random()*t.cb);return t.isActive()||(n*=2),n*e}function hn(t,e){if(t.j.info("Error code "+e),2==e){var n=u(t.fb,t),r=t.Xa;const e=!r;r=new se(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||ae(r,"https"),le(r),e?function(t,e){const n=new kt;if(i.Image){const r=new Image;r.onload=h(Ae,n,"TestLoadImage: loaded",!0,e,r),r.onerror=h(Ae,n,"TestLoadImage: error",!1,e,r),r.onabort=h(Ae,n,"TestLoadImage: abort",!1,e,r),r.ontimeout=h(Ae,n,"TestLoadImage: timeout",!1,e,r),i.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(r.toString(),n):function(t,e){new kt;const n=new AbortController,r=setTimeout((()=>{n.abort(),Ae(0,0,!1,e)}),1e4);fetch(t,{signal:n.signal}).then((t=>{clearTimeout(r),t.ok?Ae(0,0,!0,e):Ae(0,0,!1,e)})).catch((()=>{clearTimeout(r),Ae(0,0,!1,e)}))}(r.toString(),n)}else St(2);t.G=0,t.l&&t.l.sa(e),ln(t),Ye(t)}function ln(t){if(t.G=0,t.ka=[],t.l){const e=ne(t.h);0==e.length&&0==t.i.length||(f(t.ka,e),f(t.ka,t.i),t.h.i.length=0,d(t.i),t.i.length=0),t.l.ra()}}function dn(t,e,n){var r=n instanceof se?oe(n):new se(n);if(""!=r.g)e&&(r.g=e+"."+r.g),ce(r,r.s);else{var s=i.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var o=new se(null);r&&ae(o,r),e&&(o.g=e),s&&ce(o,s),n&&(o.l=n),r=o}return n=t.D,e=t.ya,n&&e&&he(r,n,e),he(r,"VER",t.la),tn(t,r),r}function fn(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ca&&!t.pa?new Fe(new Ne({eb:n})):new Fe(t.pa)).Ha(t.J),e}function pn(){}function gn(){}function mn(t,e){nt.call(this),this.g=new Qe(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.o=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.va&&(t?t["X-WebChannel-Client-Profile"]=e.va:t={"X-WebChannel-Client-Profile":e.va}),this.g.S=t,(t=e&&e.Sb)&&!p(t)&&(this.g.m=t),this.v=e&&e.supportsCrossDomainXhr||!1,this.u=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!p(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Nn(this)}function yn(t){vt.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function kn(){wt.call(this),this.status=1}function Nn(t){this.g=t}(t=Fe.prototype).Ha=function(t){this.J=t},t.ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():xt.g(),this.v=this.o?gt(this.o):gt(xt),this.g.onreadystatechange=u(this.Ea,this);try{this.B=!0,this.g.open(e,String(t),!0),this.B=!1}catch(t){return void Be(this,t)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),s=i.FormData&&t instanceof i.FormData,!(0<=Array.prototype.indexOf.call(Ue,e,void 0))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ze(this),this.u=!0,this.g.send(t),this.u=!1}catch(t){Be(this,t)}},t.abort=function(t){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=t||7,rt(this,"complete"),rt(this,"abort"),$e(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),$e(this,!0)),Fe.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?qe(this):this.bb())},t.bb=function(){qe(this)},t.isActive=function(){return!!this.g},t.Z=function(){try{return 2<Ke(this)?this.g.status:-1}catch(t){return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},t.Oa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),dt(e)}},t.Ba=function(){return this.m},t.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=Qe.prototype).la=8,t.G=1,t.connect=function(t,e,n,r){St(0),this.W=t,this.H=e||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=dn(this,null,this.W),Je(this)},t.Ga=function(t){if(this.s)if(this.s=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const i=new Ot(this,this.j,t);let s=this.o;if(this.S&&(s?(s=w(s),E(s,this.S)):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)t:{for(var e=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.i.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=en(this,i,e),he(n=oe(this.I),"RID",t),he(n,"CVER",22),this.D&&he(n,"X-HTTP-Session-Id",this.D),tn(this,n),s&&(this.O?e="headers="+encodeURIComponent(String(Oe(s)))+"&"+e:this.m&&Pe(n,this.m,s)),te(this.h,i),this.Ua&&he(n,"TYPE","init"),this.P?(he(n,"$req",e),he(n,"SID","null"),i.T=!0,Ut(i,n,null)):Ut(i,n,e),this.G=2}}else 3==this.G&&(t?Ze(this,t):0==this.i.length||Yt(this.h)||Ze(this))},t.Fa=function(){if(this.u=null,on(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var t=2*this.R;this.j.info("BP detection timer enabled: "+t),this.A=Dt(u(this.ab,this),t)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,St(10),Xe(this),on(this))},t.Za=function(){null!=this.C&&(this.C=null,Xe(this),rn(this),St(19))},t.fb=function(t){t?(this.j.info("Successfully pinged google.com"),St(2)):(this.j.info("Failed to ping google.com"),St(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=pn.prototype).ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){},gn.prototype.g=function(t,e){return new mn(t,e)},l(mn,nt),mn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},mn.prototype.close=function(){We(this.g)},mn.prototype.o=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.u&&((n={}).__data__=lt(t),t=n);e.i.push(new Wt(e.Ya++,t)),3==e.G&&Je(e)},mn.prototype.N=function(){this.g.l=null,delete this.j,We(this.g),delete this.g,mn.aa.N.call(this)},l(yn,vt),l(kn,wt),l(Nn,pn),Nn.prototype.ua=function(){rt(this.g,"a")},Nn.prototype.ta=function(t){rt(this.g,new yn(t))},Nn.prototype.sa=function(t){rt(this.g,new kn)},Nn.prototype.ra=function(){rt(this.g,"b")},gn.prototype.createWebChannel=gn.prototype.g,mn.prototype.send=mn.prototype.o,mn.prototype.open=mn.prototype.m,mn.prototype.close=mn.prototype.close,Sn=Dn.createWebChannelTransport=function(){return new gn},Cn=Dn.getStatEventTarget=function(){return Tt()},_n=Dn.Event=bt,In=Dn.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Lt.NO_ERROR=0,Lt.TIMEOUT=8,Lt.HTTP_ERROR=6,Tn=Dn.ErrorCode=Lt,Rt.COMPLETE="complete",En=Dn.EventType=Rt,mt.EventType=yt,yt.OPEN="a",yt.CLOSE="b",yt.ERROR="c",yt.MESSAGE="d",nt.prototype.listen=nt.prototype.K,bn=Dn.WebChannel=mt,wn=Dn.FetchXmlHttpFactory=Ne,Fe.prototype.listenOnce=Fe.prototype.L,Fe.prototype.getLastError=Fe.prototype.Ka,Fe.prototype.getLastErrorCode=Fe.prototype.Ba,Fe.prototype.getStatus=Fe.prototype.Z,Fe.prototype.getResponseJson=Fe.prototype.Oa,Fe.prototype.getResponseText=Fe.prototype.oa,Fe.prototype.send=Fe.prototype.ea,Fe.prototype.setWithCredentials=Fe.prototype.Ha,vn=Dn.XhrIo=Fe}).apply(void 0!==An?An:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const kn="@firebase/firestore";class Nn{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Nn.UNAUTHENTICATED=new Nn(null),Nn.GOOGLE_CREDENTIALS=new Nn("google-credentials-uid"),Nn.FIRST_PARTY=new Nn("first-party-uid"),Nn.MOCK_USER=new Nn("mock-user");let xn="10.12.1";const Ln=new x("@firebase/firestore");function Rn(){return Ln.logLevel}function Mn(t,...e){if(Ln.logLevel<=S.DEBUG){const n=e.map(Fn);Ln.debug(`Firestore (${xn}): ${t}`,...n)}}function On(t,...e){if(Ln.logLevel<=S.ERROR){const n=e.map(Fn);Ln.error(`Firestore (${xn}): ${t}`,...n)}}function Pn(t,...e){if(Ln.logLevel<=S.WARN){const n=e.map(Fn);Ln.warn(`Firestore (${xn}): ${t}`,...n)}}function Fn(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function Vn(t="Unexpected state"){const e=`FIRESTORE (${xn}) INTERNAL ASSERTION FAILED: `+t;throw On(e),new Error(e)}function Un(t,e){t||Vn()}function Bn(t,e){return t}const jn={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class qn extends h{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class $n{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class zn{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Kn{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Nn.UNAUTHENTICATED)))}shutdown(){}}class Hn{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Gn{constructor(t){this.t=t,this.currentUser=Nn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new $n;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new $n,t.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{Mn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Mn("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new $n)}}),0),s()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Mn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Un("string"==typeof e.accessToken),new zn(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return Un(null===t||"string"==typeof t),new Nn(t)}}class Qn{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=Nn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Wn{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new Qn(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(Nn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Xn{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Yn{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const n=t=>{null!=t.error&&Mn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.R;return this.R=t.token,Mn("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{Mn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?r(t):Mn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(Un("string"==typeof t.token),this.R=t.token,new Xn(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Jn(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class Zn{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=Jn(40);for(let r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return e}}function tr(t,e){return t<e?-1:t>e?1:0}function er(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}class nr{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new qn(jn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new qn(jn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new qn(jn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new qn(jn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return nr.fromMillis(Date.now())}static fromDate(t){return nr.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new nr(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?tr(this.nanoseconds,t.nanoseconds):tr(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class rr{constructor(t){this.timestamp=t}static fromTimestamp(t){return new rr(t)}static min(){return new rr(new nr(0,0))}static max(){return new rr(new nr(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ir{constructor(t,e,n){void 0===e?e=0:e>t.length&&Vn(),void 0===n?n=t.length-e:n>t.length-e&&Vn(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===ir.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof ir?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),i=e.get(r);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class sr extends ir{construct(t,e,n){return new sr(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new qn(jn.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new sr(e)}static emptyPath(){return new sr([])}}const or=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ar extends ir{construct(t,e,n){return new ar(t,e,n)}static isValidIdentifier(t){return or.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ar.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ar(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const i=()=>{if(0===n.length)throw new qn(jn.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new qn(jn.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new qn(jn.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(s=!s,r++):"."!==e||s?(n+=e,r++):(i(),r++)}if(i(),s)throw new qn(jn.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ar(e)}static emptyPath(){return new ar([])}}class cr{constructor(t){this.path=t}static fromPath(t){return new cr(sr.fromString(t))}static fromName(t){return new cr(sr.fromString(t).popFirst(5))}static empty(){return new cr(sr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===sr.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return sr.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new cr(new sr(t.slice()))}}function ur(t){return new hr(t.readTime,t.key,-1)}class hr{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new hr(rr.min(),cr.empty(),-1)}static max(){return new hr(rr.max(),cr.empty(),-1)}}function lr(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=cr.comparator(t.documentKey,e.documentKey),0!==n?n:tr(t.largestBatchId,e.largestBatchId))}const dr="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class fr{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function pr(t){if(t.code!==jn.FAILED_PRECONDITION||t.message!==dr)throw t;Mn("LocalStore","Unexpectedly lost primary lease")}class gr{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Vn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new gr(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof gr?e:gr.resolve(e)}catch(t){return gr.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):gr.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):gr.reject(e)}static resolve(t){return new gr(((e,n)=>{e(t)}))}static reject(t){return new gr(((e,n)=>{n(t)}))}static waitFor(t){return new gr(((e,n)=>{let r=0,i=0,s=!1;t.forEach((t=>{++r,t.next((()=>{++i,s&&i===r&&e()}),(t=>n(t)))})),s=!0,i===r&&e()}))}static or(t){let e=gr.resolve(!1);for(const n of t)e=e.next((t=>t?gr.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new gr(((n,r)=>{const i=t.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;e(t[c]).next((t=>{s[c]=t,++o,o===i&&n(s)}),(t=>r(t)))}}))}static doWhile(t,e){return new gr(((n,r)=>{const i=()=>{!0===t()?e().next((()=>{i()}),r):n()};i()}))}}function mr(t){return"IndexedDbTransactionError"===t.name}class yr{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ie(t),this.se=t=>e.writeSequenceNumber(t))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}function vr(t){return null==t}function wr(t){return 0===t&&1/t==-1/0}yr.oe=-1;function br(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Er(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}class Tr{constructor(t,e){this.comparator=t,this.root=e||_r.EMPTY}insert(t,e){return new Tr(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,_r.BLACK,null,null))}remove(t){return new Tr(this.comparator,this.root.remove(t,this.comparator).copy(null,null,_r.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ir(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ir(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ir(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ir(this.root,t,this.comparator,!0)}}class Ir{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class _r{constructor(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:_r.RED,this.left=null!=r?r:_r.EMPTY,this.right=null!=i?i:_r.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,i){return new _r(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const i=n(t,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return _r.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return _r.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,_r.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,_r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Vn();if(this.right.isRed())throw Vn();const t=this.left.check();if(t!==this.right.check())throw Vn();return t+(this.isRed()?0:1)}}_r.EMPTY=null,_r.RED=!0,_r.BLACK=!1,_r.EMPTY=new class{constructor(){this.size=0}get key(){throw Vn()}get value(){throw Vn()}get color(){throw Vn()}get left(){throw Vn()}get right(){throw Vn()}copy(t,e,n,r,i){return this}insert(t,e,n){return new _r(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Cr{constructor(t){this.comparator=t,this.data=new Tr(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Sr(this.data.getIterator())}getIteratorFrom(t){return new Sr(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Cr))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Cr(this.comparator);return e.data=t,e}}class Sr{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ar{constructor(t){this.fields=t,t.sort(ar.comparator)}static empty(){return new Ar([])}unionWith(t){let e=new Cr(ar.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new Ar(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return er(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class Dr extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class kr{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new Dr("Invalid base64 string: "+t):t}}(t);return new kr(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new kr(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return tr(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}kr.EMPTY_BYTE_STRING=new kr("");const Nr=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function xr(t){if(Un(!!t),"string"==typeof t){let e=0;const n=Nr.exec(t);if(Un(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Lr(t.seconds),nanos:Lr(t.nanos)}}function Lr(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Rr(t){return"string"==typeof t?kr.fromBase64String(t):kr.fromUint8Array(t)}function Mr(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Or(t){const e=t.mapValue.fields.__previous_value__;return Mr(e)?Or(e):e}function Pr(t){const e=xr(t.mapValue.fields.__local_write_time__.timestampValue);return new nr(e.seconds,e.nanos)}class Fr{constructor(t,e,n,r,i,s,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class Vr{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new Vr("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Vr&&t.projectId===this.projectId&&t.database===this.database}}const Ur={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Br(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Mr(t)?4:Zr(t)?9007199254740991:10:Vn()}function jr(t,e){if(t===e)return!0;const n=Br(t);if(n!==Br(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Pr(t).isEqual(Pr(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=xr(t.timestampValue),r=xr(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Rr(t.bytesValue).isEqual(Rr(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Lr(t.geoPointValue.latitude)===Lr(e.geoPointValue.latitude)&&Lr(t.geoPointValue.longitude)===Lr(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Lr(t.integerValue)===Lr(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Lr(t.doubleValue),r=Lr(e.doubleValue);return n===r?wr(n)===wr(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return er(t.arrayValue.values||[],e.arrayValue.values||[],jr);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(br(n)!==br(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!jr(n[t],r[t])))return!1;return!0}(t,e);default:return Vn()}}function qr(t,e){return void 0!==(t.values||[]).find((t=>jr(t,e)))}function $r(t,e){if(t===e)return 0;const n=Br(t),r=Br(e);if(n!==r)return tr(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return tr(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Lr(t.integerValue||t.doubleValue),r=Lr(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return zr(t.timestampValue,e.timestampValue);case 4:return zr(Pr(t),Pr(e));case 5:return tr(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Rr(t),r=Rr(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=tr(n[t],r[t]);if(0!==e)return e}return tr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=tr(Lr(t.latitude),Lr(e.latitude));return 0!==n?n:tr(Lr(t.longitude),Lr(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=$r(n[t],r[t]);if(e)return e}return tr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===Ur.mapValue&&e===Ur.mapValue)return 0;if(t===Ur.mapValue)return 1;if(e===Ur.mapValue)return-1;const n=t.fields||{},r=Object.keys(n),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let t=0;t<r.length&&t<s.length;++t){const e=tr(r[t],s[t]);if(0!==e)return e;const o=$r(n[r[t]],i[s[t]]);if(0!==o)return o}return tr(r.length,s.length)}(t.mapValue,e.mapValue);default:throw Vn()}}function zr(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return tr(t,e);const n=xr(t),r=xr(e),i=tr(n.seconds,r.seconds);return 0!==i?i:tr(n.nanos,r.nanos)}function Kr(t){return Hr(t)}function Hr(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=xr(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return Rr(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return cr.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=Hr(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const i of e)r?r=!1:n+=",",n+=`${i}:${Hr(t.fields[i])}`;return n+"}"}(t.mapValue):Vn()}function Gr(t){return!!t&&"integerValue"in t}function Qr(t){return!!t&&"arrayValue"in t}function Wr(t){return!!t&&"nullValue"in t}function Xr(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Yr(t){return!!t&&"mapValue"in t}function Jr(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Er(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Jr(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Jr(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Zr(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class ti{constructor(t){this.value=t}static empty(){return new ti({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Yr(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Jr(e)}setAll(t){let e=ar.emptyPath(),n={},r=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=i.popLast()}t?n[i.lastSegment()]=Jr(t):r.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,r)}delete(t){const e=this.field(t.popLast());Yr(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return jr(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];Yr(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){Er(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new ti(Jr(this.value))}}class ei{constructor(t,e,n,r,i,s,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(t){return new ei(t,0,rr.min(),rr.min(),rr.min(),ti.empty(),0)}static newFoundDocument(t,e,n,r){return new ei(t,1,e,rr.min(),n,r,0)}static newNoDocument(t,e){return new ei(t,2,e,rr.min(),rr.min(),ti.empty(),0)}static newUnknownDocument(t,e){return new ei(t,3,e,rr.min(),rr.min(),ti.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(rr.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=ti.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=ti.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=rr.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof ei&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new ei(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ni{constructor(t,e){this.position=t,this.inclusive=e}}function ri(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(r=s.field.isKeyField()?cr.comparator(cr.fromName(o.referenceValue),n.key):$r(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function ii(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!jr(t.position[n],e.position[n]))return!1;return!0}class si{constructor(t,e="asc"){this.field=t,this.dir=e}}function oi(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class ai{}class ci extends ai{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new gi(t,e,n):"array-contains"===e?new wi(t,n):"in"===e?new bi(t,n):"not-in"===e?new Ei(t,n):"array-contains-any"===e?new Ti(t,n):new ci(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new mi(t,n):new yi(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison($r(e,this.value)):null!==e&&Br(this.value)===Br(e)&&this.matchesComparison($r(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Vn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ui extends ai{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new ui(t,e)}matches(t){return hi(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function hi(t){return"and"===t.op}function li(t){return function(t){for(const e of t.filters)if(e instanceof ui)return!1;return!0}(t)&&hi(t)}function di(t){if(t instanceof ci)return t.field.canonicalString()+t.op.toString()+Kr(t.value);if(li(t))return t.filters.map((t=>di(t))).join(",");{const e=t.filters.map((t=>di(t))).join(",");return`${t.op}(${e})`}}function fi(t,e){return t instanceof ci?function(t,e){return e instanceof ci&&t.op===e.op&&t.field.isEqual(e.field)&&jr(t.value,e.value)}(t,e):t instanceof ui?function(t,e){return e instanceof ui&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&fi(n,e.filters[r])),!0)}(t,e):void Vn()}function pi(t){return t instanceof ci?function(t){return`${t.field.canonicalString()} ${t.op} ${Kr(t.value)}`}(t):t instanceof ui?function(t){return t.op.toString()+" {"+t.getFilters().map(pi).join(" ,")+"}"}(t):"Filter"}class gi extends ci{constructor(t,e,n){super(t,e,n),this.key=cr.fromName(n.referenceValue)}matches(t){const e=cr.comparator(t.key,this.key);return this.matchesComparison(e)}}class mi extends ci{constructor(t,e){super(t,"in",e),this.keys=vi(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class yi extends ci{constructor(t,e){super(t,"not-in",e),this.keys=vi(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function vi(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>cr.fromName(t.referenceValue)))}class wi extends ci{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Qr(e)&&qr(e.arrayValue,this.value)}}class bi extends ci{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&qr(this.value.arrayValue,e)}}class Ei extends ci{constructor(t,e){super(t,"not-in",e)}matches(t){if(qr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!qr(this.value.arrayValue,e)}}class Ti extends ci{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Qr(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>qr(this.value.arrayValue,t)))}}class Ii{constructor(t,e=null,n=[],r=[],i=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ue=null}}function _i(t,e=null,n=[],r=[],i=null,s=null,o=null){return new Ii(t,e,n,r,i,s,o)}function Ci(t){const e=Bn(t);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>di(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),vr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>Kr(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>Kr(t))).join(",")),e.ue=t}return e.ue}function Si(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!oi(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!fi(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ii(t.startAt,e.startAt)&&ii(t.endAt,e.endAt)}function Ai(t){return cr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Di{constructor(t,e=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function ki(t){return new Di(t)}function Ni(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function xi(t){const e=Bn(t);if(null===e.ce){e.ce=[];const t=new Set;for(const n of e.explicitOrderBy)e.ce.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new Cr(ar.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);r.forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.ce.push(new si(r,n))})),t.has(ar.keyField().canonicalString())||e.ce.push(new si(ar.keyField(),n))}return e.ce}function Li(t){const e=Bn(t);return e.le||(e.le=function(t,e){if("F"===t.limitType)return _i(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new si(t.field,e)}));const n=t.endAt?new ni(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new ni(t.startAt.position,t.startAt.inclusive):null;return _i(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}(e,xi(t))),e.le}function Ri(t,e,n){return new Di(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Mi(t,e){return Si(Li(t),Li(e))&&t.limitType===e.limitType}function Oi(t){return`${Ci(Li(t))}|lt:${t.limitType}`}function Pi(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>pi(t))).join(", ")}]`),vr(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>Kr(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>Kr(t))).join(",")),`Target(${e})`}(Li(t))}; limitType=${t.limitType})`}function Fi(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):cr.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of xi(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=ri(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,xi(t),e)||t.endAt&&!function(t,e,n){const r=ri(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,xi(t),e))}(t,e)}function Vi(t){return(e,n)=>{let r=!1;for(const i of xi(t)){const t=Ui(i,e,n);if(0!==t)return t;r=r||i.field.isKeyField()}return 0}}function Ui(t,e,n){const r=t.field.isKeyField()?cr.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?$r(r,i):Vn()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Vn()}}class Bi{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){Er(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(this.inner)}size(){return this.innerSize}}const ji=new Tr(cr.comparator);function qi(){return ji}const $i=new Tr(cr.comparator);function zi(...t){let e=$i;for(const n of t)e=e.insert(n.key,n);return e}function Ki(t){let e=$i;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function Hi(){return Qi()}function Gi(){return Qi()}function Qi(){return new Bi((t=>t.toString()),((t,e)=>t.isEqual(e)))}new Tr(cr.comparator);const Wi=new Cr(cr.comparator);function Xi(...t){let e=Wi;for(const n of t)e=e.add(n);return e}const Yi=new Cr(tr);class Ji{constructor(){this._=void 0}}function Zi(t,e,n){return t instanceof es?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Mr(e)&&(e=Or(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof ns?rs(t,e):t instanceof is?ss(t,e):function(t,e){const n=function(t,e){return t instanceof os?function(t){return Gr(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}(t,e),r=as(n)+as(t.Pe);return Gr(n)&&Gr(t.Pe)?function(t){return{integerValue:""+t}}(r):function(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:wr(e)?"-0":e}}(t.serializer,r)}(t,e)}function ts(t,e,n){return t instanceof ns?rs(t,e):t instanceof is?ss(t,e):n}class es extends Ji{}class ns extends Ji{constructor(t){super(),this.elements=t}}function rs(t,e){const n=cs(e);for(const e of t.elements)n.some((t=>jr(t,e)))||n.push(e);return{arrayValue:{values:n}}}class is extends Ji{constructor(t){super(),this.elements=t}}function ss(t,e){let n=cs(e);for(const e of t.elements)n=n.filter((t=>!jr(t,e)));return{arrayValue:{values:n}}}class os extends Ji{constructor(t,e){super(),this.serializer=t,this.Pe=e}}function as(t){return Lr(t.integerValue||t.doubleValue)}function cs(t){return Qr(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class us{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new us}static exists(t){return new us(void 0,t)}static updateTime(t){return new us(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function hs(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class ls{}function ds(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Es(t.key,us.none()):new ms(t.key,t.data,us.none());{const n=t.data,r=ti.empty();let i=new Cr(ar.comparator);for(let t of e.fields)if(!i.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),i=i.add(t)}return new ys(t.key,r,new Ar(i.toArray()),us.none())}}function fs(t,e,n){t instanceof ms?function(t,e,n){const r=t.value.clone(),i=ws(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof ys?function(t,e,n){if(!hs(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=ws(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(vs(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function ps(t,e,n,r){return t instanceof ms?function(t,e,n,r){if(!hs(t.precondition,e))return n;const i=t.value.clone(),s=bs(t.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}(t,e,n,r):t instanceof ys?function(t,e,n,r){if(!hs(t.precondition,e))return n;const i=bs(t.fieldTransforms,r,e),s=e.data;return s.setAll(vs(t)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return hs(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function gs(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&er(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof ns&&e instanceof ns||t instanceof is&&e instanceof is?er(t.elements,e.elements,jr):t instanceof os&&e instanceof os?jr(t.Pe,e.Pe):t instanceof es&&e instanceof es}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class ms extends ls{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class ys extends ls{constructor(t,e,n,r,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function vs(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function ws(t,e,n){const r=new Map;Un(t.length===n.length);for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,ts(o,a,n[i]))}return r}function bs(t,e,n){const r=new Map;for(const i of t){const t=i.transform,s=n.data.field(i.field);r.set(i.field,Zi(t,s,e))}return r}class Es extends ls{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ts{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&fs(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=ps(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=ps(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=Gi();return this.mutations.forEach((r=>{const i=t.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=e.has(r.key)?null:o;const a=ds(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(rr.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),Xi())}isEqual(t){return this.batchId===t.batchId&&er(this.mutations,t.mutations,((t,e)=>gs(t,e)))&&er(this.baseMutations,t.baseMutations,((t,e)=>gs(t,e)))}}class Is{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class _s{constructor(t,e){this.count=t,this.unchangedNames=e}}var Cs,Ss;function As(t){if(void 0===t)return On("GRPC error has no .code"),jn.UNKNOWN;switch(t){case Cs.OK:return jn.OK;case Cs.CANCELLED:return jn.CANCELLED;case Cs.UNKNOWN:return jn.UNKNOWN;case Cs.DEADLINE_EXCEEDED:return jn.DEADLINE_EXCEEDED;case Cs.RESOURCE_EXHAUSTED:return jn.RESOURCE_EXHAUSTED;case Cs.INTERNAL:return jn.INTERNAL;case Cs.UNAVAILABLE:return jn.UNAVAILABLE;case Cs.UNAUTHENTICATED:return jn.UNAUTHENTICATED;case Cs.INVALID_ARGUMENT:return jn.INVALID_ARGUMENT;case Cs.NOT_FOUND:return jn.NOT_FOUND;case Cs.ALREADY_EXISTS:return jn.ALREADY_EXISTS;case Cs.PERMISSION_DENIED:return jn.PERMISSION_DENIED;case Cs.FAILED_PRECONDITION:return jn.FAILED_PRECONDITION;case Cs.ABORTED:return jn.ABORTED;case Cs.OUT_OF_RANGE:return jn.OUT_OF_RANGE;case Cs.UNIMPLEMENTED:return jn.UNIMPLEMENTED;case Cs.DATA_LOSS:return jn.DATA_LOSS;default:return Vn()}}(Ss=Cs||(Cs={}))[Ss.OK=0]="OK",Ss[Ss.CANCELLED=1]="CANCELLED",Ss[Ss.UNKNOWN=2]="UNKNOWN",Ss[Ss.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ss[Ss.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ss[Ss.NOT_FOUND=5]="NOT_FOUND",Ss[Ss.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ss[Ss.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ss[Ss.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ss[Ss.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ss[Ss.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ss[Ss.ABORTED=10]="ABORTED",Ss[Ss.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ss[Ss.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ss[Ss.INTERNAL=13]="INTERNAL",Ss[Ss.UNAVAILABLE=14]="UNAVAILABLE",Ss[Ss.DATA_LOSS=15]="DATA_LOSS";const Ds=new pn([4294967295,4294967295],0);function ks(t){const e=(new TextEncoder).encode(t),n=new gn;return n.update(e),new Uint8Array(n.digest())}function Ns(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new pn([n,r],0),new pn([i,s],0)]}class xs{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Ls(`Invalid padding: ${e}`);if(n<0)throw new Ls(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new Ls(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new Ls(`Invalid padding when bitmap length is 0: ${e}`);this.Ie=8*t.length-e,this.Te=pn.fromNumber(this.Ie)}Ee(t,e,n){let r=t.add(e.multiply(pn.fromNumber(n)));return 1===r.compare(Ds)&&(r=new pn([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}de(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.Ie)return!1;const e=ks(t),[n,r]=Ns(e);for(let t=0;t<this.hashCount;t++){const e=this.Ee(n,r,t);if(!this.de(e))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),s=new xs(i,r,e);return n.forEach((t=>s.insert(t))),s}insert(t){if(0===this.Ie)return;const e=ks(t),[n,r]=Ns(e);for(let t=0;t<this.hashCount;t++){const e=this.Ee(n,r,t);this.Ae(e)}}Ae(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class Ls extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Rs{constructor(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,Ms.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Rs(rr.min(),r,new Tr(tr),qi(),Xi())}}class Ms{constructor(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Ms(n,e,Xi(),Xi(),Xi())}}class Os{constructor(t,e,n,r){this.Re=t,this.removedTargetIds=e,this.key=n,this.Ve=r}}class Ps{constructor(t,e){this.targetId=t,this.me=e}}class Fs{constructor(t,e,n=kr.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class Vs{constructor(){this.fe=0,this.ge=js(),this.pe=kr.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}Ce(){let t=Xi(),e=Xi(),n=Xi();return this.ge.forEach(((r,i)=>{switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Vn()}})),new Ms(this.pe,this.ye,t,e,n)}ve(){this.we=!1,this.ge=js()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,Un(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Us{constructor(t){this.Le=t,this.Be=new Map,this.ke=qi(),this.qe=Bs(),this.Qe=new Tr(tr)}Ke(t){for(const e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.$e(e,t.Ve):this.Ue(e,t.key,t.Ve);for(const e of t.removedTargetIds)this.Ue(e,t.key,t.Ve)}We(t){this.forEachTarget(t,(e=>{const n=this.Ge(e);switch(t.state){case 0:this.ze(e)&&n.De(t.resumeToken);break;case 1:n.Oe(),n.Se||n.ve(),n.De(t.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(e);break;case 3:this.ze(e)&&(n.Ne(),n.De(t.resumeToken));break;case 4:this.ze(e)&&(this.je(e),n.De(t.resumeToken));break;default:Vn()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Be.forEach(((t,n)=>{this.ze(n)&&e(n)}))}He(t){const e=t.targetId,n=t.me.count,r=this.Je(e);if(r){const i=r.target;if(Ai(i))if(0===n){const t=new cr(i.path);this.Ue(e,t,ei.newNoDocument(t,rr.min()))}else Un(1===n);else{const r=this.Ye(e);if(r!==n){const n=this.Ze(t),i=n?this.Xe(n,t,r):1;if(0!==i){this.je(e);const t=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(e,t)}}}}}Ze(t){const e=t.me.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=e;let s,o;try{s=Rr(n).toUint8Array()}catch(t){if(t instanceof Dr)return Pn("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new xs(s,r,i)}catch(t){return Pn(t instanceof Ls?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.Ie?null:o}Xe(t,e,n){return e.me.count===n-this.nt(t,e.targetId)?0:2}nt(t,e){const n=this.Le.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const i=this.Le.tt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.mightContain(s)||(this.Ue(e,n,null),r++)})),r}rt(t){const e=new Map;this.Be.forEach(((n,r)=>{const i=this.Je(r);if(i){if(n.current&&Ai(i.target)){const e=new cr(i.target.path);null!==this.ke.get(e)||this.it(r,e)||this.Ue(r,e,ei.newNoDocument(e,t))}n.be&&(e.set(r,n.Ce()),n.ve())}}));let n=Xi();this.qe.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.Je(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.ke.forEach(((e,n)=>n.setReadTime(t)));const r=new Rs(t,e,this.Qe,this.ke,n);return this.ke=qi(),this.qe=Bs(),this.Qe=new Tr(tr),r}$e(t,e){if(!this.ze(t))return;const n=this.it(t,e.key)?2:0;this.Ge(t).Fe(e.key,n),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t))}Ue(t,e,n){if(!this.ze(t))return;const r=this.Ge(t);this.it(t,e)?r.Fe(e,1):r.Me(e),this.qe=this.qe.insert(e,this.st(e).delete(t)),n&&(this.ke=this.ke.insert(e,n))}removeTarget(t){this.Be.delete(t)}Ye(t){const e=this.Ge(t).Ce();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.Ge(t).xe()}Ge(t){let e=this.Be.get(t);return e||(e=new Vs,this.Be.set(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new Cr(tr),this.qe=this.qe.insert(t,e)),e}ze(t){const e=null!==this.Je(t);return e||Mn("WatchChangeAggregator","Detected inactive target",t),e}Je(t){const e=this.Be.get(t);return e&&e.Se?null:this.Le.ot(t)}je(t){this.Be.set(t,new Vs),this.Le.getRemoteKeysForTarget(t).forEach((e=>{this.Ue(t,e,null)}))}it(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}}function Bs(){return new Tr(cr.comparator)}function js(){return new Tr(cr.comparator)}const qs={asc:"ASCENDING",desc:"DESCENDING"},$s={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},zs={and:"AND",or:"OR"};class Ks{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function Hs(t,e){return t.useProto3Json||vr(e)?e:{value:e}}function Gs(t){return Un(!!t),rr.fromTimestamp(function(t){const e=xr(t);return new nr(e.seconds,e.nanos)}(t))}function Qs(t,e){const n=function(t){return new sr(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function Ws(t){const e=sr.fromString(t);return Un(ho(e)),e}function Xs(t,e){const n=Ws(e);if(n.get(1)!==t.databaseId.projectId)throw new qn(jn.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new qn(jn.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new cr(Zs(n))}function Ys(t,e){return function(t,e){return Qs(t,e).canonicalString()}(t.databaseId,e)}function Js(t){return new sr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Zs(t){return Un(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function to(t,e){return{documents:[Ys(t,e.path)]}}function eo(t,e){const n={structuredQuery:{}},r=e.path;let i;null!==e.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Ys(t,i);const s=function(t){if(0!==t.length)return uo(ui.create(t,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const o=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:ao(t.field),direction:io(t.dir)}}(t)))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=Hs(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{_t:n,parent:i}}function no(t){let e=function(t){const e=Ws(t);return 4===e.length?sr.emptyPath():Zs(e)}(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Un(1===r);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=function(t){const e=ro(t);return e instanceof ui&&li(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new si(co(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,vr(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new ni(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new ni(n,e)}(n.endAt)),function(t,e,n,r,i,s,o,a){return new Di(t,e,n,r,i,s,o,a)}(e,i,o,s,a,"F",c,u)}function ro(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=co(t.unaryFilter.field);return ci.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=co(t.unaryFilter.field);return ci.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=co(t.unaryFilter.field);return ci.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=co(t.unaryFilter.field);return ci.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Vn()}}(t):void 0!==t.fieldFilter?function(t){return ci.create(co(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Vn()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return ui.create(t.compositeFilter.filters.map((t=>ro(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Vn()}}(t.compositeFilter.op))}(t):Vn()}function io(t){return qs[t]}function so(t){return $s[t]}function oo(t){return zs[t]}function ao(t){return{fieldPath:t.canonicalString()}}function co(t){return ar.fromServerFormat(t.fieldPath)}function uo(t){return t instanceof ci?function(t){if("=="===t.op){if(Xr(t.value))return{unaryFilter:{field:ao(t.field),op:"IS_NAN"}};if(Wr(t.value))return{unaryFilter:{field:ao(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Xr(t.value))return{unaryFilter:{field:ao(t.field),op:"IS_NOT_NAN"}};if(Wr(t.value))return{unaryFilter:{field:ao(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ao(t.field),op:so(t.op),value:t.value}}}(t):t instanceof ui?function(t){const e=t.getFilters().map((t=>uo(t)));return 1===e.length?e[0]:{compositeFilter:{op:oo(t.op),filters:e}}}(t):Vn()}function ho(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class lo{constructor(t,e,n,r,i=rr.min(),s=rr.min(),o=kr.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new lo(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new lo(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new lo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new lo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class fo{constructor(t){this.ct=t}}function po(t){const e=no({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Ri(e,e.limit,"L"):e}class go{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt(Lr(t.integerValue));else if("doubleValue"in t){const n=Lr(t.doubleValue);isNaN(n)?this.Et(e,13):(this.Et(e,15),wr(n)?e.dt(0):e.dt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Et(e,20),"string"==typeof n&&(n=xr(n)),e.At(`${n.seconds||""}`),e.dt(n.nanos||0)}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft(Rr(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Et(e,45),e.dt(n.latitude||0),e.dt(n.longitude||0)}else"mapValue"in t?Zr(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):Vn()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){const n=t.fields||{};this.Et(e,55);for(const t of Object.keys(n))this.Rt(t,e),this.It(n[t],e)}wt(t,e){const n=t.values||[];this.Et(e,50);for(const t of n)this.It(t,e)}gt(t,e){this.Et(e,37),cr.fromName(t).path.forEach((t=>{this.Et(e,60),this.St(t,e)}))}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}}go.bt=new go;class mo{constructor(){this._n=new yo}addToCollectionParentIndex(t,e){return this._n.add(e),gr.resolve()}getCollectionParents(t,e){return gr.resolve(this._n.getEntries(e))}addFieldIndex(t,e){return gr.resolve()}deleteFieldIndex(t,e){return gr.resolve()}deleteAllFieldIndexes(t){return gr.resolve()}createTargetIndexes(t,e){return gr.resolve()}getDocumentsMatchingTarget(t,e){return gr.resolve(null)}getIndexType(t,e){return gr.resolve(0)}getFieldIndexes(t,e){return gr.resolve([])}getNextCollectionGroupToUpdate(t){return gr.resolve(null)}getMinOffset(t,e){return gr.resolve(hr.min())}getMinOffsetFromCollectionGroup(t,e){return gr.resolve(hr.min())}updateCollectionGroup(t,e,n){return gr.resolve()}updateIndexEntries(t,e){return gr.resolve()}}class yo{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Cr(sr.comparator),i=!r.has(n);return this.index[e]=r.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new Cr(sr.comparator)).toArray()}}new Uint8Array(0);class vo{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new vo(t,vo.DEFAULT_COLLECTION_PERCENTILE,vo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}vo.DEFAULT_COLLECTION_PERCENTILE=10,vo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,vo.DEFAULT=new vo(41943040,vo.DEFAULT_COLLECTION_PERCENTILE,vo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),vo.DISABLED=new vo(-1,0,0);class wo{constructor(t){this.On=t}next(){return this.On+=2,this.On}static Nn(){return new wo(0)}static Ln(){return new wo(-1)}}class bo{constructor(){this.changes=new Bi((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,ei.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?gr.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Eo{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class To{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&ps(n.mutation,t,Ar.empty(),nr.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,Xi()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=Xi()){const r=Hi();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=zi();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=Hi();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,Xi())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let i=qi();const s=Qi(),o=Qi();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof ys)?i=i.insert(e.key,e):void 0!==o?(s.set(e.key,o.mutation.getFieldMask()),ps(o.mutation,e,o.mutation.getFieldMask(),nr.now())):s.set(e.key,Ar.empty())})),this.recalculateAndSaveOverlays(t,i).next((t=>(t.forEach(((t,e)=>s.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new Eo(e,null!==(n=s.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=Qi();let r=new Tr(((t,e)=>t-e)),i=Xi();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const i of t)i.keys().forEach((t=>{const s=e.get(t);if(null===s)return;let o=n.get(t)||Ar.empty();o=i.applyToLocalView(s,o),n.set(t,o);const a=(r.get(i.batchId)||Xi()).add(t);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=Gi();c.forEach((t=>{if(!i.has(t)){const r=ds(e.get(t),n.get(t));null!==r&&u.set(t,r),i=i.add(t)}})),s.push(this.documentOverlayCache.saveOverlays(t,a,u))}return gr.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return cr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-i.size):gr.resolve(Hi());let o=-1,a=i;return s.next((e=>gr.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(e)?gr.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,i))).next((()=>this.computeViews(t,a,e,Xi()))).next((t=>({batchId:o,changes:Ki(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new cr(e)).next((t=>{let e=zi();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const i=e.collectionGroup;let s=zi();return this.indexManager.getCollectionParents(t,i).next((o=>gr.forEach(o,(o=>{const a=function(t,e){return new Di(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(i));return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(t,e,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,r)))).next((t=>{i.forEach(((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,ei.newInvalidDocument(r)))}));let n=zi();return t.forEach(((t,r)=>{const s=i.get(t);void 0!==s&&ps(s.mutation,r,Ar.empty(),nr.now()),Fi(e,r)&&(n=n.insert(t,r))})),n}))}}class Io{constructor(t){this.serializer=t,this.cr=new Map,this.lr=new Map}getBundleMetadata(t,e){return gr.resolve(this.cr.get(e))}saveBundleMetadata(t,e){return this.cr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:Gs(t.createTime)}}(e)),gr.resolve()}getNamedQuery(t,e){return gr.resolve(this.lr.get(e))}saveNamedQuery(t,e){return this.lr.set(e.name,function(t){return{name:t.name,query:po(t.bundledQuery),readTime:Gs(t.readTime)}}(e)),gr.resolve()}}class _o{constructor(){this.overlays=new Tr(cr.comparator),this.hr=new Map}getOverlay(t,e){return gr.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Hi();return gr.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.ht(t,e,r)})),gr.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.hr.delete(n)),gr.resolve()}getOverlaysForCollection(t,e,n){const r=Hi(),i=e.length+1,s=new cr(e.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const t=o.getNext().value,s=t.getKey();if(!e.isPrefixOf(s.path))break;s.path.length===i&&t.largestBatchId>n&&r.set(t.getKey(),t)}return gr.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new Tr(((t,e)=>t-e));const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=Hi(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=Hi(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return gr.resolve(o)}ht(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Is(e,n));let i=this.hr.get(e);void 0===i&&(i=Xi(),this.hr.set(e,i)),this.hr.set(e,i.add(n.key))}}class Co{constructor(){this.Pr=new Cr(So.Ir),this.Tr=new Cr(So.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(t,e){const n=new So(t,e);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Ar(new So(t,e))}Rr(t,e){t.forEach((t=>this.removeReference(t,e)))}Vr(t){const e=new cr(new sr([])),n=new So(e,t),r=new So(e,t+1),i=[];return this.Tr.forEachInRange([n,r],(t=>{this.Ar(t),i.push(t.key)})),i}mr(){this.Pr.forEach((t=>this.Ar(t)))}Ar(t){this.Pr=this.Pr.delete(t),this.Tr=this.Tr.delete(t)}gr(t){const e=new cr(new sr([])),n=new So(e,t),r=new So(e,t+1);let i=Xi();return this.Tr.forEachInRange([n,r],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new So(t,0),n=this.Pr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class So{constructor(t,e){this.key=t,this.pr=e}static Ir(t,e){return cr.comparator(t.key,e.key)||tr(t.pr,e.pr)}static Er(t,e){return tr(t.pr,e.pr)||cr.comparator(t.key,e.key)}}class Ao{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.yr=1,this.wr=new Cr(So.Ir)}checkEmpty(t){return gr.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Ts(i,e,n,r);this.mutationQueue.push(s);for(const e of r)this.wr=this.wr.add(new So(e.key,i)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return gr.resolve(s)}lookupMutationBatch(t,e){return gr.resolve(this.Sr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.br(n),i=r<0?0:r;return gr.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return gr.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(t){return gr.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new So(e,0),r=new So(e,Number.POSITIVE_INFINITY),i=[];return this.wr.forEachInRange([n,r],(t=>{const e=this.Sr(t.pr);i.push(e)})),gr.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Cr(tr);return e.forEach((t=>{const e=new So(t,0),r=new So(t,Number.POSITIVE_INFINITY);this.wr.forEachInRange([e,r],(t=>{n=n.add(t.pr)}))})),gr.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let i=n;cr.isDocumentKey(i)||(i=i.child(""));const s=new So(new cr(i),0);let o=new Cr(tr);return this.wr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.pr)),!0)}),s),gr.resolve(this.Dr(o))}Dr(t){const e=[];return t.forEach((t=>{const n=this.Sr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){Un(0===this.Cr(e.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return gr.forEach(e.mutations,(r=>{const i=new So(r.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.wr=n}))}Mn(t){}containsKey(t,e){const n=new So(e,0),r=this.wr.firstAfterOrEqual(n);return gr.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,gr.resolve()}Cr(t,e){return this.br(t)}br(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Sr(t){const e=this.br(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Do{constructor(t){this.vr=t,this.docs=new Tr(cr.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),i=r?r.size:0,s=this.vr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return gr.resolve(n?n.document.mutableCopy():ei.newInvalidDocument(e))}getEntries(t,e){let n=qi();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():ei.newInvalidDocument(t))})),gr.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let i=qi();const s=e.path,o=new cr(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!s.isPrefixOf(t.path))break;t.path.length>s.length+1||lr(ur(o),n)<=0||(r.has(o.key)||Fi(e,o))&&(i=i.insert(o.key,o.mutableCopy()))}return gr.resolve(i)}getAllFromCollectionGroup(t,e,n,r){Vn()}Fr(t,e){return gr.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new ko(this)}getSize(t){return gr.resolve(this.size)}}class ko extends bo{constructor(t){super(),this.ar=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this.ar.addEntry(t,r)):this.ar.removeEntry(n)})),gr.waitFor(e)}getFromCache(t,e){return this.ar.getEntry(t,e)}getAllFromCache(t,e){return this.ar.getEntries(t,e)}}class No{constructor(t){this.persistence=t,this.Mr=new Bi((t=>Ci(t)),Si),this.lastRemoteSnapshotVersion=rr.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Co,this.targetCount=0,this.Lr=wo.Nn()}forEachTarget(t,e){return this.Mr.forEach(((t,n)=>e(n))),gr.resolve()}getLastRemoteSnapshotVersion(t){return gr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return gr.resolve(this.Or)}allocateTargetId(t){return this.highestTargetId=this.Lr.next(),gr.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Or&&(this.Or=e),gr.resolve()}qn(t){this.Mr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Lr=new wo(e),this.highestTargetId=e),t.sequenceNumber>this.Or&&(this.Or=t.sequenceNumber)}addTargetData(t,e){return this.qn(e),this.targetCount+=1,gr.resolve()}updateTargetData(t,e){return this.qn(e),gr.resolve()}removeTargetData(t,e){return this.Mr.delete(e.target),this.Nr.Vr(e.targetId),this.targetCount-=1,gr.resolve()}removeTargets(t,e,n){let r=0;const i=[];return this.Mr.forEach(((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Mr.delete(s),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),gr.waitFor(i).next((()=>r))}getTargetCount(t){return gr.resolve(this.targetCount)}getTargetData(t,e){const n=this.Mr.get(e)||null;return gr.resolve(n)}addMatchingKeys(t,e,n){return this.Nr.dr(e,n),gr.resolve()}removeMatchingKeys(t,e,n){this.Nr.Rr(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((e=>{i.push(r.markPotentiallyOrphaned(t,e))})),gr.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.Nr.Vr(e),gr.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Nr.gr(e);return gr.resolve(n)}containsKey(t,e){return gr.resolve(this.Nr.containsKey(e))}}class xo{constructor(t,e){this.Br={},this.overlays={},this.kr=new yr(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new No(this),this.indexManager=new mo,this.remoteDocumentCache=function(t){return new Do(t)}((t=>this.referenceDelegate.Kr(t))),this.serializer=new fo(e),this.$r=new Io(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new _o,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Br[t.toKey()];return n||(n=new Ao(e,this.referenceDelegate),this.Br[t.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(t,e,n){Mn("MemoryPersistence","Starting transaction:",t);const r=new Lo(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((t=>this.referenceDelegate.Wr(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Gr(t,e){return gr.or(Object.values(this.Br).map((n=>()=>n.containsKey(t,e))))}}class Lo extends fr{constructor(t){super(),this.currentSequenceNumber=t}}class Ro{constructor(t){this.persistence=t,this.zr=new Co,this.jr=null}static Hr(t){return new Ro(t)}get Jr(){if(this.jr)return this.jr;throw Vn()}addReference(t,e,n){return this.zr.addReference(n,e),this.Jr.delete(n.toString()),gr.resolve()}removeReference(t,e,n){return this.zr.removeReference(n,e),this.Jr.add(n.toString()),gr.resolve()}markPotentiallyOrphaned(t,e){return this.Jr.add(e.toString()),gr.resolve()}removeTarget(t,e){this.zr.Vr(e.targetId).forEach((t=>this.Jr.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Jr.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Ur(){this.jr=new Set}Wr(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return gr.forEach(this.Jr,(n=>{const r=cr.fromPath(n);return this.Yr(t,r).next((t=>{t||e.removeEntry(r,rr.min())}))})).next((()=>(this.jr=null,e.apply(t))))}updateLimboDocument(t,e){return this.Yr(t,e).next((t=>{t?this.Jr.delete(e.toString()):this.Jr.add(e.toString())}))}Kr(t){return 0}Yr(t,e){return gr.or([()=>gr.resolve(this.zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gr(t,e)])}}class Mo{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.qi=n,this.Qi=r}static Ki(t,e){let n=Xi(),r=Xi();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new Mo(t,e.fromCache,n,r)}}class Oo{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Po{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=!function(){var e;const n=null===(e=s())||void 0===e?void 0:e.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(t.g.process)}catch(t){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:function(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")>0?6:4}initialize(t,e){this.zi=t,this.indexManager=e,this.$i=!0}getDocumentsMatchingQuery(t,e,n,r){const i={result:null};return this.ji(t,e).next((t=>{i.result=t})).next((()=>{if(!i.result)return this.Hi(t,e,r,n).next((t=>{i.result=t}))})).next((()=>{if(i.result)return;const n=new Oo;return this.Ji(t,e,n).next((r=>{if(i.result=r,this.Ui)return this.Yi(t,e,n,r.size)}))})).next((()=>i.result))}Yi(t,e,n,r){return n.documentReadCount<this.Wi?(Rn()<=S.DEBUG&&Mn("QueryEngine","SDK will not create cache indexes for query:",Pi(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),gr.resolve()):(Rn()<=S.DEBUG&&Mn("QueryEngine","Query:",Pi(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(Rn()<=S.DEBUG&&Mn("QueryEngine","The SDK decides to create cache indexes for query:",Pi(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Li(e))):gr.resolve())}ji(t,e){if(Ni(e))return gr.resolve(null);let n=Li(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=Ri(e,null,"F"),n=Li(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const i=Xi(...r);return this.zi.getDocuments(t,i).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const s=this.Zi(e,r);return this.Xi(e,s,i,n.readTime)?this.ji(t,Ri(e,null,"F")):this.es(t,s,e,n)}))))})))))}Hi(t,e,n,r){return Ni(e)||r.isEqual(rr.min())?gr.resolve(null):this.zi.getDocuments(t,n).next((i=>{const s=this.Zi(e,i);return this.Xi(e,s,n,r)?gr.resolve(null):(Rn()<=S.DEBUG&&Mn("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Pi(e)),this.es(t,s,e,function(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=rr.fromTimestamp(1e9===r?new nr(n+1,0):new nr(n,r));return new hr(i,cr.empty(),e)}(r,-1)).next((t=>t)))}))}Zi(t,e){let n=new Cr(Vi(t));return e.forEach(((e,r)=>{Fi(t,r)&&(n=n.add(r))})),n}Xi(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ji(t,e,n){return Rn()<=S.DEBUG&&Mn("QueryEngine","Using full collection scan to execute query:",Pi(e)),this.zi.getDocumentsMatchingQuery(t,e,hr.min(),n)}es(t,e,n,r){return this.zi.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class Fo{constructor(t,e,n,r){this.persistence=t,this.ts=e,this.serializer=r,this.ns=new Tr(tr),this.rs=new Bi((t=>Ci(t)),Si),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(n)}_s(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new To(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.ns)))}}async function Vo(t,e){const n=Bn(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((i=>(r=i,n._s(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const i=[],s=[];let o=Xi();for(const t of r){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({us:t,removedBatchIds:i,addedBatchIds:s})))}))}))}function Uo(t){const e=Bn(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Qr.getLastRemoteSnapshotVersion(t)))}async function Bo(t,e,n){const r=Bn(t),i=r.ns.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(t=>r.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!mr(t))throw t;Mn("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.ns=r.ns.remove(e),r.rs.delete(i.target)}function jo(t,e,n){const r=Bn(t);let i=rr.min(),s=Xi();return r.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const r=Bn(t),i=r.rs.get(n);return void 0!==i?gr.resolve(r.ns.get(i)):r.Qr.getTargetData(e,n)}(r,t,Li(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(t,e.targetId).next((t=>{s=t}))})).next((()=>r.ts.getDocumentsMatchingQuery(t,e,n?i:rr.min(),n?s:Xi()))).next((t=>(function(t,e,n){let r=t.ss.get(e)||rr.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.ss.set(e,r)}(r,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,hs:s})))))}class qo{constructor(){this.activeTargetIds=Yi}As(t){this.activeTargetIds=this.activeTargetIds.add(t)}Rs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ds(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class $o{constructor(){this.no=new qo,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.no.As(t),this.ro[t]||"not-current"}updateQueryState(t,e,n){this.ro[t]=e}removeLocalQueryTarget(t){this.no.Rs(t)}isLocalQueryTarget(t){return this.no.activeTargetIds.has(t)}clearQueryState(t){delete this.ro[t]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(t){return this.no.activeTargetIds.has(t)}start(){return this.no=new qo,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class zo{io(t){}shutdown(){}}class Ko{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(t){this.uo.push(t)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){Mn("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.uo)t(0)}ao(){Mn("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.uo)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Ho=null;function Go(){return null===Ho?Ho=268435456+Math.round(2147483648*Math.random()):Ho++,"0x"+Ho.toString(16)}const Qo={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Wo{constructor(t){this.lo=t.lo,this.ho=t.ho}Po(t){this.Io=t}To(t){this.Eo=t}Ao(t){this.Ro=t}onMessage(t){this.Vo=t}close(){this.ho()}send(t){this.lo(t)}mo(){this.Io()}fo(){this.Eo()}po(t){this.Ro(t)}yo(t){this.Vo(t)}}const Xo="WebChannelConnection";class Yo extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.wo=e+"://"+t.host,this.So=`projects/${n}/databases/${r}`,this.bo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get Do(){return!1}Co(t,e,n,r,i){const s=Go(),o=this.vo(t,e.toUriEncodedString());Mn("RestConnection",`Sending RPC '${t}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.So,"x-goog-request-params":this.bo};return this.Fo(a,r,i),this.Mo(t,o,a,n).then((e=>(Mn("RestConnection",`Received RPC '${t}' ${s}: `,e),e)),(e=>{throw Pn("RestConnection",`RPC '${t}' ${s} failed with error: `,e,"url: ",o,"request:",n),e}))}xo(t,e,n,r,i,s){return this.Co(t,e,n,r,i)}Fo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+xn,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}vo(t,e){const n=Qo[t];return`${this.wo}/v1/${e}:${n}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Mo(t,e,n,r){const i=Go();return new Promise(((s,o)=>{const a=new vn;a.setWithCredentials(!0),a.listenOnce(En.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Tn.NO_ERROR:const e=a.getResponseJson();Mn(Xo,`XHR for RPC '${t}' ${i} received:`,JSON.stringify(e)),s(e);break;case Tn.TIMEOUT:Mn(Xo,`RPC '${t}' ${i} timed out`),o(new qn(jn.DEADLINE_EXCEEDED,"Request time out"));break;case Tn.HTTP_ERROR:const n=a.getStatus();if(Mn(Xo,`RPC '${t}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(jn).indexOf(e)>=0?e:jn.UNKNOWN}(e.status);o(new qn(t,e.message))}else o(new qn(jn.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new qn(jn.UNAVAILABLE,"Connection failed."));break;default:Vn()}}finally{Mn(Xo,`RPC '${t}' ${i} completed.`)}}));const c=JSON.stringify(r);Mn(Xo,`RPC '${t}' ${i} sending request:`,r),a.send(e,"POST",c,n,15)}))}Oo(t,e,n){const r=Go(),i=[this.wo,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=Sn(),o=Cn(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.xmlHttpFactory=new wn({})),this.Fo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const u=i.join("");Mn(Xo,`Creating RPC '${t}' stream ${r}: ${u}`,a);const h=s.createWebChannel(u,a);let l=!1,d=!1;const f=new Wo({lo:e=>{d?Mn(Xo,`Not sending because RPC '${t}' stream ${r} is closed:`,e):(l||(Mn(Xo,`Opening RPC '${t}' stream ${r} transport.`),h.open(),l=!0),Mn(Xo,`RPC '${t}' stream ${r} sending:`,e),h.send(e))},ho:()=>h.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(h,bn.EventType.OPEN,(()=>{d||(Mn(Xo,`RPC '${t}' stream ${r} transport opened.`),f.mo())})),p(h,bn.EventType.CLOSE,(()=>{d||(d=!0,Mn(Xo,`RPC '${t}' stream ${r} transport closed`),f.po())})),p(h,bn.EventType.ERROR,(e=>{d||(d=!0,Pn(Xo,`RPC '${t}' stream ${r} transport errored:`,e),f.po(new qn(jn.UNAVAILABLE,"The operation could not be completed")))})),p(h,bn.EventType.MESSAGE,(e=>{var n;if(!d){const i=e.data[0];Un(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){Mn(Xo,`RPC '${t}' stream ${r} received error:`,o);const e=o.status;let n=function(t){const e=Cs[t];if(void 0!==e)return As(e)}(e),i=o.message;void 0===n&&(n=jn.INTERNAL,i="Unknown error status: "+e+" with message "+o.message),d=!0,f.po(new qn(n,i)),h.close()}else Mn(Xo,`RPC '${t}' stream ${r} received:`,i),f.yo(i)}})),p(o,_n.STAT_EVENT,(e=>{e.stat===In.PROXY?Mn(Xo,`RPC '${t}' stream ${r} detected buffering proxy`):e.stat===In.NOPROXY&&Mn(Xo,`RPC '${t}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.fo()}),0),f}}function Jo(){return"undefined"!=typeof document?document:null}function Zo(t){return new Ks(t,!0)}class ta{constructor(t,e,n=1e3,r=1.5,i=6e4){this.oi=t,this.timerId=e,this.No=n,this.Lo=r,this.Bo=i,this.ko=0,this.qo=null,this.Qo=Date.now(),this.reset()}reset(){this.ko=0}Ko(){this.ko=this.Bo}$o(t){this.cancel();const e=Math.floor(this.ko+this.Uo()),n=Math.max(0,Date.now()-this.Qo),r=Math.max(0,e-n);r>0&&Mn("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.ko} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.qo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.Qo=Date.now(),t()))),this.ko*=this.Lo,this.ko<this.No&&(this.ko=this.No),this.ko>this.Bo&&(this.ko=this.Bo)}Wo(){null!==this.qo&&(this.qo.skipDelay(),this.qo=null)}cancel(){null!==this.qo&&(this.qo.cancel(),this.qo=null)}Uo(){return(Math.random()-.5)*this.ko}}class ea{constructor(t,e,n,r,i,s,o,a){this.oi=t,this.Go=n,this.zo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.jo=0,this.Ho=null,this.Jo=null,this.stream=null,this.Yo=new ta(t,e)}Zo(){return 1===this.state||5===this.state||this.Xo()}Xo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.e_()}async stop(){this.Zo()&&await this.close(0)}t_(){this.state=0,this.Yo.reset()}n_(){this.Xo()&&null===this.Ho&&(this.Ho=this.oi.enqueueAfterDelay(this.Go,6e4,(()=>this.r_())))}i_(t){this.s_(),this.stream.send(t)}async r_(){if(this.Xo())return this.close(0)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}o_(){this.Jo&&(this.Jo.cancel(),this.Jo=null)}async close(t,e){this.s_(),this.o_(),this.Yo.cancel(),this.jo++,4!==t?this.Yo.reset():e&&e.code===jn.RESOURCE_EXHAUSTED?(On(e.toString()),On("Using maximum backoff delay to prevent overloading the backend."),this.Yo.Ko()):e&&e.code===jn.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.__(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Ao(e)}__(){}auth(){this.state=1;const t=this.a_(this.jo),e=this.jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.jo===e&&this.u_(t,n)}),(e=>{t((()=>{const t=new qn(jn.UNKNOWN,"Fetching auth token failed: "+e.message);return this.c_(t)}))}))}u_(t,e){const n=this.a_(this.jo);this.stream=this.l_(t,e),this.stream.Po((()=>{n((()=>this.listener.Po()))})),this.stream.To((()=>{n((()=>(this.state=2,this.Jo=this.oi.enqueueAfterDelay(this.zo,1e4,(()=>(this.Xo()&&(this.state=3),Promise.resolve()))),this.listener.To())))})),this.stream.Ao((t=>{n((()=>this.c_(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}e_(){this.state=5,this.Yo.$o((async()=>{this.state=0,this.start()}))}c_(t){return Mn("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}a_(t){return e=>{this.oi.enqueueAndForget((()=>this.jo===t?e():(Mn("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class na extends ea{constructor(t,e,n,r,i,s){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i}l_(t,e){return this.connection.Oo("Listen",t,e)}onMessage(t){this.Yo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Vn()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(t,e){return t.useProto3Json?(Un(void 0===e||"string"==typeof e),kr.fromBase64String(e||"")):(Un(void 0===e||e instanceof Buffer||e instanceof Uint8Array),kr.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?jn.UNKNOWN:As(t.code);return new qn(e,t.message||"")}(o);n=new Fs(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Xs(t,r.document.name),s=Gs(r.document.updateTime),o=r.document.createTime?Gs(r.document.createTime):rr.min(),a=new ti({mapValue:{fields:r.document.fields}}),c=ei.newFoundDocument(i,s,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];n=new Os(u,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Xs(t,r.document),s=r.readTime?Gs(r.readTime):rr.min(),o=ei.newNoDocument(i,s),a=r.removedTargetIds||[];n=new Os([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Xs(t,r.document),s=r.removedTargetIds||[];n=new Os([],s,i,null)}else{if(!("filter"in e))return Vn();{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:i}=t,s=new _s(r,i),o=t.targetId;n=new Ps(o,s)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return rr.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?rr.min():e.readTime?Gs(e.readTime):rr.min()}(t);return this.listener.h_(e,n)}P_(t){const e={};e.database=Js(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=Ai(r)?{documents:to(t,r)}:{query:eo(t,r)._t},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=function(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}(t,e.resumeToken);const r=Hs(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(rr.min())>0){n.readTime=function(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}(t,e.snapshotVersion.toTimestamp());const r=Hs(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Vn()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.i_(e)}I_(t){const e={};e.database=Js(this.serializer),e.removeTarget=t,this.i_(e)}}class ra extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.m_=!1}f_(){if(this.m_)throw new qn(jn.FAILED_PRECONDITION,"The client has already been terminated.")}Co(t,e,n,r){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.Co(t,Qs(e,n),r,i,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===jn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new qn(jn.UNKNOWN,t.toString())}))}xo(t,e,n,r,i){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.xo(t,Qs(e,n),r,s,o,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===jn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new qn(jn.UNKNOWN,t.toString())}))}terminate(){this.m_=!0,this.connection.terminate()}}class ia{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){0===this.g_&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve()))))}D_(t){"Online"===this.state?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.S_("Offline")))}set(t){this.C_(),this.g_=0,"Online"===t&&(this.y_=!1),this.S_(t)}S_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}b_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(On(e),this.y_=!1):Mn("OnlineStateTracker",e)}C_(){null!==this.p_&&(this.p_.cancel(),this.p_=null)}}class sa{constructor(t,e,n,r,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=i,this.O_.io((t=>{n.enqueueAndForget((async()=>{pa(this)&&(Mn("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Bn(t);e.M_.add(4),await aa(e),e.N_.set("Unknown"),e.M_.delete(4),await oa(e)}(this))}))})),this.N_=new ia(n,r)}}async function oa(t){if(pa(t))for(const e of t.x_)await e(!0)}async function aa(t){for(const e of t.x_)await e(!1)}function ca(t,e){const n=Bn(t);n.F_.has(e.targetId)||(n.F_.set(e.targetId,e),fa(n)?da(n):Ta(n).Xo()&&ha(n,e))}function ua(t,e){const n=Bn(t),r=Ta(n);n.F_.delete(e),r.Xo()&&la(n,e),0===n.F_.size&&(r.Xo()?r.n_():pa(n)&&n.N_.set("Unknown"))}function ha(t,e){if(t.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(rr.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Ta(t).P_(e)}function la(t,e){t.L_.xe(e),Ta(t).I_(e)}function da(t){t.L_=new Us({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.F_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),Ta(t).start(),t.N_.w_()}function fa(t){return pa(t)&&!Ta(t).Zo()&&t.F_.size>0}function pa(t){return 0===Bn(t).M_.size}function ga(t){t.L_=void 0}async function ma(t){t.N_.set("Online")}async function ya(t){t.F_.forEach(((e,n)=>{ha(t,e)}))}async function va(t,e){ga(t),fa(t)?(t.N_.D_(e),da(t)):t.N_.set("Unknown")}async function wa(t,e,n){if(t.N_.set("Online"),e instanceof Fs&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.F_.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.F_.delete(r),t.L_.removeTarget(r))}(t,e)}catch(n){Mn("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await ba(t,n)}else if(e instanceof Os?t.L_.Ke(e):e instanceof Ps?t.L_.He(e):t.L_.We(e),!n.isEqual(rr.min()))try{const e=await Uo(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.L_.rt(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.F_.get(r);i&&t.F_.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const r=t.F_.get(e);if(!r)return;t.F_.set(e,r.withResumeToken(kr.EMPTY_BYTE_STRING,r.snapshotVersion)),la(t,e);const i=new lo(r.target,e,n,r.sequenceNumber);ha(t,i)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Mn("RemoteStore","Failed to raise snapshot:",e),await ba(t,e)}}async function ba(t,e,n){if(!mr(e))throw e;t.M_.add(1),await aa(t),t.N_.set("Offline"),n||(n=()=>Uo(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Mn("RemoteStore","Retrying IndexedDB access"),await n(),t.M_.delete(1),await oa(t)}))}async function Ea(t,e){const n=Bn(t);n.asyncQueue.verifyOperationInProgress(),Mn("RemoteStore","RemoteStore received new credentials");const r=pa(n);n.M_.add(3),await aa(n),r&&n.N_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.M_.delete(3),await oa(n)}function Ta(t){return t.B_||(t.B_=function(t,e,n){const r=Bn(t);return r.f_(),new na(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Po:ma.bind(null,t),To:ya.bind(null,t),Ao:va.bind(null,t),h_:wa.bind(null,t)}),t.x_.push((async e=>{e?(t.B_.t_(),fa(t)?da(t):t.N_.set("Unknown")):(await t.B_.stop(),ga(t))}))),t.B_}class Ia{constructor(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new $n,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,i){const s=Date.now()+n,o=new Ia(t,e,s,r,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new qn(jn.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function _a(t,e){if(On("AsyncQueue",`${e}: ${t}`),mr(t))return new qn(jn.UNAVAILABLE,`${e}: ${t}`);throw t}class Ca{constructor(t){this.comparator=t?(e,n)=>t(e,n)||cr.comparator(e.key,n.key):(t,e)=>cr.comparator(t.key,e.key),this.keyedMap=zi(),this.sortedSet=new Tr(this.comparator)}static emptySet(t){return new Ca(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Ca))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Ca;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Sa{constructor(){this.q_=new Tr(cr.comparator)}track(t){const e=t.doc.key,n=this.q_.get(e);n?0!==t.type&&3===n.type?this.q_=this.q_.insert(e,t):3===t.type&&1!==n.type?this.q_=this.q_.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.q_=this.q_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.q_=this.q_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.q_=this.q_.remove(e):1===t.type&&2===n.type?this.q_=this.q_.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.q_=this.q_.insert(e,{type:2,doc:t.doc}):Vn():this.q_=this.q_.insert(e,t)}Q_(){const t=[];return this.q_.inorderTraversal(((e,n)=>{t.push(n)})),t}}class Aa{constructor(t,e,n,r,i,s,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,i){const s=[];return e.forEach((t=>{s.push({type:0,doc:t})})),new Aa(t,e,Ca.emptySet(e),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Mi(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Da{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some((t=>t.G_()))}}class ka{constructor(){this.queries=new Bi((t=>Oi(t)),Mi),this.onlineState="Unknown",this.z_=new Set}}function Na(t,e){const n=Bn(t);let r=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.U_)e.H_(t)&&(r=!0);i.K_=t}}r&&La(n)}function xa(t,e,n){const r=Bn(t),i=r.queries.get(e);if(i)for(const t of i.U_)t.onError(n);r.queries.delete(e)}function La(t){t.z_.forEach((t=>{t.next()}))}var Ra,Ma;(Ma=Ra||(Ra={})).J_="default",Ma.Cache="cache";class Oa{constructor(t,e,n){this.query=t,this.Y_=e,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=n||{}}H_(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Aa(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Z_?this.ea(t)&&(this.Y_.next(t),e=!0):this.ta(t,this.onlineState)&&(this.na(t),e=!0),this.X_=t,e}onError(t){this.Y_.error(t)}j_(t){this.onlineState=t;let e=!1;return this.X_&&!this.Z_&&this.ta(this.X_,t)&&(this.na(this.X_),e=!0),e}ta(t,e){if(!t.fromCache)return!0;if(!this.G_())return!0;const n="Offline"!==e;return(!this.options.ra||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}ea(t){if(t.docChanges.length>0)return!0;const e=this.X_&&this.X_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}na(t){t=Aa.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Z_=!0,this.Y_.next(t)}G_(){return this.options.source!==Ra.Cache}}class Pa{constructor(t){this.key=t}}class Fa{constructor(t){this.key=t}}class Va{constructor(t,e){this.query=t,this.la=e,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=Xi(),this.mutatedKeys=Xi(),this.Ia=Vi(t),this.Ta=new Ca(this.Ia)}get Ea(){return this.la}da(t,e){const n=e?e.Aa:new Sa,r=e?e.Ta:this.Ta;let i=e?e.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const u=r.get(t),h=Fi(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Ra(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.Ia(h,a)>0||c&&this.Ia(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(s=s.add(h),i=d?i.add(t):i.delete(t)):(s=s.delete(t),i=i.delete(t)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const t="F"===this.query.limitType?s.last():s.first();s=s.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{Ta:s,Aa:n,Xi:o,mutatedKeys:i}}Ra(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const i=this.Ta;this.Ta=t.Ta,this.mutatedKeys=t.mutatedKeys;const s=t.Aa.Q_();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Vn()}};return n(t)-n(e)}(t.type,e.type)||this.Ia(t.doc,e.doc))),this.Va(n),r=null!=r&&r;const o=e&&!r?this.ma():[],a=0===this.Pa.size&&this.current&&!r?1:0,c=a!==this.ha;return this.ha=a,0!==s.length||c?{snapshot:new Aa(this.query,t.Ta,i,s,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),fa:o}:{fa:o}}j_(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new Sa,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{fa:[]}}ga(t){return!this.la.has(t)&&!!this.Ta.has(t)&&!this.Ta.get(t).hasLocalMutations}Va(t){t&&(t.addedDocuments.forEach((t=>this.la=this.la.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.la=this.la.delete(t))),this.current=t.current)}ma(){if(!this.current)return[];const t=this.Pa;this.Pa=Xi(),this.Ta.forEach((t=>{this.ga(t.key)&&(this.Pa=this.Pa.add(t.key))}));const e=[];return t.forEach((t=>{this.Pa.has(t)||e.push(new Fa(t))})),this.Pa.forEach((n=>{t.has(n)||e.push(new Pa(n))})),e}pa(t){this.la=t.hs,this.Pa=Xi();const e=this.da(t.documents);return this.applyChanges(e,!0)}ya(){return Aa.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,0===this.ha,this.hasCachedResults)}}class Ua{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Ba{constructor(t){this.key=t,this.wa=!1}}class ja{constructor(t,e,n,r,i,s){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Sa={},this.ba=new Bi((t=>Oi(t)),Mi),this.Da=new Map,this.Ca=new Set,this.va=new Tr(cr.comparator),this.Fa=new Map,this.Ma=new Co,this.xa={},this.Oa=new Map,this.Na=wo.Ln(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return!0===this.La}}async function qa(t,e,n=!0){const r=ic(t);let i;const s=r.ba.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=await za(r,e,n,!0),i}async function $a(t,e){const n=ic(t);await za(n,e,!0,!1)}async function za(t,e,n,r){const i=await function(t,e){const n=Bn(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Qr.getTargetData(t,e).next((i=>i?(r=i,gr.resolve(r)):n.Qr.allocateTargetId(t).next((i=>(r=new lo(e,i,"TargetPurposeListen",t.currentSequenceNumber),n.Qr.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.ns.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(t.targetId,t),n.rs.set(e,t.targetId)),t}))}(t.localStore,Li(e)),s=i.targetId,o=n?t.sharedClientState.addLocalQueryTarget(s):"not-current";let a;return r&&(a=await async function(t,e,n,r,i){t.Ba=(e,n,r)=>async function(t,e,n,r){let i=e.view.da(n);i.Xi&&(i=await jo(t.localStore,e.query,!1).then((({documents:t})=>e.view.da(t,i))));const s=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(i,t.isPrimaryClient,s,o);return Ja(t,e.targetId,a.fa),a.snapshot}(t,e,n,r);const s=await jo(t.localStore,e,!0),o=new Va(e,s.hs),a=o.da(s.documents),c=Ms.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,i),u=o.applyChanges(a,t.isPrimaryClient,c);Ja(t,n,u.fa);const h=new Ua(e,n,o);return t.ba.set(e,h),t.Da.has(n)?t.Da.get(n).push(e):t.Da.set(n,[e]),u.snapshot}(t,e,s,"current"===o,i.resumeToken)),t.isPrimaryClient&&n&&ca(t.remoteStore,i),a}async function Ka(t,e,n){const r=Bn(t),i=r.ba.get(e),s=r.Da.get(i.targetId);if(s.length>1)return r.Da.set(i.targetId,s.filter((t=>!Mi(t,e)))),void r.ba.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Bo(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&ua(r.remoteStore,i.targetId),Xa(r,i.targetId)})).catch(pr)):(Xa(r,i.targetId),await Bo(r.localStore,i.targetId,!0))}async function Ha(t,e){const n=Bn(t),r=n.ba.get(e),i=n.Da.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),ua(n.remoteStore,r.targetId))}async function Ga(t,e){const n=Bn(t);try{const t=await function(t,e){const n=Bn(t),r=e.snapshotVersion;let i=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const s=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;const o=[];e.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Qr.removeMatchingKeys(t,s.removedDocuments,a).next((()=>n.Qr.addMatchingKeys(t,s.addedDocuments,a))));let u=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?u=u.withResumeToken(kr.EMPTY_BYTE_STRING,rr.min()).withLastLimboFreeSnapshotVersion(rr.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Qr.updateTargetData(t,u))}));let a=qi(),c=Xi();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(function(t,e,n){let r=Xi(),i=Xi();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=qi();return n.forEach(((n,s)=>{const o=t.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(rr.min())?(e.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(s),r=r.insert(n,s)):Mn("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{cs:r,ls:i}}))}(t,s,e.documentUpdates).next((t=>{a=t.cs,c=t.ls}))),!r.isEqual(rr.min())){const e=n.Qr.getLastRemoteSnapshotVersion(t).next((e=>n.Qr.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return gr.waitFor(o).next((()=>s.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.ns=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.Fa.get(e);r&&(Un(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.wa=!0:t.modifiedDocuments.size>0?Un(r.wa):t.removedDocuments.size>0&&(Un(r.wa),r.wa=!1))})),await ec(n,t,e)}catch(t){await pr(t)}}function Qa(t,e,n){const r=Bn(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.ba.forEach(((n,r)=>{const i=r.view.j_(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=Bn(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.U_)t.j_(e)&&(r=!0)})),r&&La(n)}(r.eventManager,e),t.length&&r.Sa.h_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Wa(t,e,n){const r=Bn(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Fa.get(e),s=i&&i.key;if(s){let t=new Tr(cr.comparator);t=t.insert(s,ei.newNoDocument(s,rr.min()));const n=Xi().add(s),i=new Rs(rr.min(),new Map,new Tr(tr),t,n);await Ga(r,i),r.va=r.va.remove(s),r.Fa.delete(e),tc(r)}else await Bo(r.localStore,e,!1).then((()=>Xa(r,e,n))).catch(pr)}function Xa(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Da.get(e))t.ba.delete(r),n&&t.Sa.ka(r,n);t.Da.delete(e),t.isPrimaryClient&&t.Ma.Vr(e).forEach((e=>{t.Ma.containsKey(e)||Ya(t,e)}))}function Ya(t,e){t.Ca.delete(e.path.canonicalString());const n=t.va.get(e);null!==n&&(ua(t.remoteStore,n),t.va=t.va.remove(e),t.Fa.delete(n),tc(t))}function Ja(t,e,n){for(const r of n)r instanceof Pa?(t.Ma.addReference(r.key,e),Za(t,r)):r instanceof Fa?(Mn("SyncEngine","Document no longer in limbo: "+r.key),t.Ma.removeReference(r.key,e),t.Ma.containsKey(r.key)||Ya(t,r.key)):Vn()}function Za(t,e){const n=e.key,r=n.path.canonicalString();t.va.get(n)||t.Ca.has(r)||(Mn("SyncEngine","New document in limbo: "+n),t.Ca.add(r),tc(t))}function tc(t){for(;t.Ca.size>0&&t.va.size<t.maxConcurrentLimboResolutions;){const e=t.Ca.values().next().value;t.Ca.delete(e);const n=new cr(sr.fromString(e)),r=t.Na.next();t.Fa.set(r,new Ba(n)),t.va=t.va.insert(n,r),ca(t.remoteStore,new lo(Li(ki(n.path)),r,"TargetPurposeLimboResolution",yr.oe))}}async function ec(t,e,n){const r=Bn(t),i=[],s=[],o=[];r.ba.isEmpty()||(r.ba.forEach(((t,a)=>{o.push(r.Ba(a,e,n).then((t=>{if((t||n)&&r.isPrimaryClient){const e=t&&!t.fromCache;r.sharedClientState.updateQueryState(a.targetId,e?"current":"not-current")}if(t){i.push(t);const e=Mo.Ki(a.targetId,t);s.push(e)}})))})),await Promise.all(o),r.Sa.h_(i),await async function(t,e){const n=Bn(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>gr.forEach(e,(e=>gr.forEach(e.qi,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>gr.forEach(e.Qi,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!mr(t))throw t;Mn("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.ns.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.ns=n.ns.insert(e,i)}}}(r.localStore,s))}async function nc(t,e){const n=Bn(t);if(!n.currentUser.isEqual(e)){Mn("SyncEngine","User change. New user:",e.toKey());const t=await Vo(n.localStore,e);n.currentUser=e,function(t,e){t.Oa.forEach((t=>{t.forEach((t=>{t.reject(new qn(jn.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Oa.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await ec(n,t.us)}}function rc(t,e){const n=Bn(t),r=n.Fa.get(e);if(r&&r.wa)return Xi().add(r.key);{let t=Xi();const r=n.Da.get(e);if(!r)return t;for(const e of r){const r=n.ba.get(e);t=t.unionWith(r.view.Ea)}return t}}function ic(t){const e=Bn(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ga.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=rc.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Wa.bind(null,e),e.Sa.h_=Na.bind(null,e.eventManager),e.Sa.ka=xa.bind(null,e.eventManager),e}class sc{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=Zo(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return function(t,e,n,r){return new Fo(t,e,n,r)}(this.persistence,new Po,t.initialUser,this.serializer)}createPersistence(t){return new xo(Ro.Hr,this.serializer)}createSharedClientState(t){return new $o}async terminate(){var t,e;null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(e=this.indexBackfillerScheduler)||void 0===e||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class oc{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Qa(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=nc.bind(null,this.syncEngine),await async function(t,e){const n=Bn(t);e?(n.M_.delete(2),await oa(n)):e||(n.M_.add(2),await aa(n),n.N_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new ka}createDatastore(t){const e=Zo(t.databaseInfo.databaseId),n=function(t){return new Yo(t)}(t.databaseInfo);return function(t,e,n,r){return new ra(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,i){return new sa(t,e,n,r,i)}(this.localStore,this.datastore,t.asyncQueue,(t=>Qa(this.syncEngine,t,0)),Ko.D()?new Ko:new zo)}createSyncEngine(t,e){return function(t,e,n,r,i,s,o){const a=new ja(t,e,n,r,i,s);return o&&(a.La=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t;await async function(t){const e=Bn(t);Mn("RemoteStore","RemoteStore shutting down."),e.M_.add(5),await aa(e),e.O_.shutdown(),e.N_.set("Unknown")}(this.remoteStore),null===(t=this.datastore)||void 0===t||t.terminate()}}class ac{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ka(this.observer.next,t)}error(t){this.observer.error?this.Ka(this.observer.error,t):On("Uncaught Error in snapshot listener:",t.toString())}$a(){this.muted=!0}Ka(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class cc{constructor(t,e,n,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=Nn.UNAUTHENTICATED,this.clientId=Zn.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{Mn("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Mn("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new qn(jn.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new $n;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=_a(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function uc(t,e){t.asyncQueue.verifyOperationInProgress(),Mn("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await Vo(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function hc(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Mn("FirestoreClient","Using user provided OfflineComponentProvider");try{await uc(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===jn.FAILED_PRECONDITION||t.code===jn.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;Pn("Error using user provided cache. Falling back to memory cache: "+n),await uc(t,new sc)}}else Mn("FirestoreClient","Using default OfflineComponentProvider"),await uc(t,new sc);return t._offlineComponents}(t);Mn("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((t=>Ea(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Ea(e.remoteStore,n))),t._onlineComponents=e}async function lc(t){const e=await async function(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Mn("FirestoreClient","Using user provided OnlineComponentProvider"),await hc(t,t._uninitializedComponentsProvider._online)):(Mn("FirestoreClient","Using default OnlineComponentProvider"),await hc(t,new oc))),t._onlineComponents}(t),n=e.eventManager;return n.onListen=qa.bind(null,e.syncEngine),n.onUnlisten=Ka.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=$a.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=Ha.bind(null,e.syncEngine),n}function dc(t,e,n={}){const r=new $n;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,i){const s=new ac({next:n=>{e.enqueueAndForget((()=>async function(t,e){const n=Bn(t),r=e.query;let i=3;const s=n.queries.get(r);if(s){const t=s.U_.indexOf(e);t>=0&&(s.U_.splice(t,1),0===s.U_.length?i=e.G_()?0:1:!s.W_()&&e.G_()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}(t,o))),n.fromCache&&"server"===r.source?i.reject(new qn(jn.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new Oa(n,s,{includeMetadataChanges:!0,ra:!0});return async function(t,e){const n=Bn(t);let r=3;const i=e.query;let s=n.queries.get(i);s?!s.W_()&&e.G_()&&(r=2):(s=new Da,r=e.G_()?0:1);try{switch(r){case 0:s.K_=await n.onListen(i,!0);break;case 1:s.K_=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(t){const n=_a(t,`Initialization of query '${Pi(e.query)}' failed`);return void e.onError(n)}n.queries.set(i,s),s.U_.push(e),e.j_(n.onlineState),s.K_&&e.H_(s.K_)&&La(n)}(t,o)}(await lc(t),t.asyncQueue,e,n,r))),r.promise}function fc(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const pc=new Map;function gc(t){if(cr.isDocumentKey(t))throw new qn(jn.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function mc(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new qn(jn.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=function(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Vn()}(t);throw new qn(jn.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class yc{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new qn(jn.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new qn(jn.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new qn(jn.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=fc(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new qn(jn.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new qn(jn.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new qn(jn.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class vc{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new yc({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new qn(jn.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new qn(jn.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new yc(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Kn;switch(t.type){case"firstParty":return new Wn(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new qn(jn.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=pc.get(t);e&&(Mn("ComponentProvider","Removing Datastore"),pc.delete(t),e.terminate())}(this),Promise.resolve()}}class wc{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new wc(this.firestore,t,this._query)}}class bc{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ec(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new bc(this.firestore,t,this._key)}}class Ec extends wc{constructor(t,e,n){super(t,e,ki(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new bc(this.firestore,null,new cr(t))}withConverter(t){return new Ec(this.firestore,t,this._path)}}function Tc(t,e,...n){if(t=b(t),function(t,e,n){if(!n)throw new qn(jn.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}("collection","path",e),t instanceof vc){const r=sr.fromString(e,...n);return gc(r),new Ec(t,null,r)}{if(!(t instanceof bc||t instanceof Ec))throw new qn(jn.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(sr.fromString(e,...n));return gc(r),new Ec(t.firestore,null,r)}}class Ic{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Yo=new ta(this,"async_queue_retry"),this.hu=()=>{const t=Jo();t&&Mn("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Yo.Wo()};const t=Jo();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Pu(),this.Iu(t)}enterRestrictedMode(t){if(!this.ou){this.ou=!0,this.cu=t||!1;const e=Jo();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.hu)}}enqueue(t){if(this.Pu(),this.ou)return new Promise((()=>{}));const e=new $n;return this.Iu((()=>this.ou&&this.cu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.su.push(t),this.Tu())))}async Tu(){if(0!==this.su.length){try{await this.su[0](),this.su.shift(),this.Yo.reset()}catch(t){if(!mr(t))throw t;Mn("AsyncQueue","Operation failed with retryable error: "+t)}this.su.length>0&&this.Yo.$o((()=>this.Tu()))}}Iu(t){const e=this.iu.then((()=>(this.uu=!0,t().catch((t=>{this.au=t,this.uu=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw On("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.uu=!1,t))))));return this.iu=e,e}enqueueAfterDelay(t,e,n){this.Pu(),this.lu.indexOf(t)>-1&&(e=0);const r=Ia.createAndSchedule(this,t,e,n,(t=>this.Eu(t)));return this._u.push(r),r}Pu(){this.au&&Vn()}verifyOperationInProgress(){}async du(){let t;do{t=this.iu,await t}while(t!==this.iu)}Au(t){for(const e of this._u)if(e.timerId===t)return!0;return!1}Ru(t){return this.du().then((()=>{this._u.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this._u)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.du()}))}Vu(t){this.lu.push(t)}Eu(t){const e=this._u.indexOf(t);this._u.splice(e,1)}}class _c extends vc{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new Ic,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Cc(this),this._firestoreClient.terminate()}}function Cc(t){var e,n,r;const i=t._freezeSettings(),s=function(t,e,n,r){return new Fr(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,fc(r.experimentalLongPollingOptions),r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,i);t._firestoreClient=new cc(t._authCredentials,t._appCheckCredentials,t._queue,s),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}class Sc{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Sc(kr.fromBase64String(t))}catch(t){throw new qn(jn.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Sc(kr.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Ac{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new qn(jn.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ar(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Dc{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new qn(jn.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new qn(jn.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return tr(this._lat,t._lat)||tr(this._long,t._long)}}const kc=new RegExp("[~\\*/\\[\\]]");function Nc(t,e,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new qn(jn.INVALID_ARGUMENT,a+t+c)}class xc{constructor(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new bc(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Lc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Rc("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Lc extends xc{data(){return super.data()}}function Rc(t,e){return"string"==typeof e?function(t,e,n){if(e.search(kc)>=0)throw Nc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Ac(...e.split("."))._internalPath}catch(r){throw Nc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}(t,e):e instanceof Ac?e._internalPath:e._delegate._internalPath}class Mc{convertValue(t,e="none"){switch(Br(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Lr(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Rr(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Vn()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return Er(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new Dc(Lr(t.latitude),Lr(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Or(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Pr(t));default:return null}}convertTimestamp(t){const e=xr(t);return new nr(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=sr.fromString(t);Un(ho(n));const r=new Vr(n.get(1),n.get(3)),i=new cr(n.popFirst(5));return r.isEqual(e)||On(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}class Oc{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Pc extends xc{constructor(t,e,n,r,i,s){super(t,e,n,r,s),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Fc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Rc("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Fc extends Pc{data(t={}){return super.data(t)}}class Vc{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Oc(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Fc(this._firestore,this._userDataWriter,n.key,n,new Oc(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new qn(jn.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const r=new Fc(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Oc(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new Fc(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Oc(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,s=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),s=n.indexOf(e.doc.key)),{type:Uc(e.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Uc(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Vn()}}class Bc extends Mc{constructor(t){super(),this.firestore=t}convertBytes(t){return new Sc(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new bc(this.firestore,null,e)}}function jc(t){t=mc(t,wc);const e=mc(t.firestore,_c),n=function(t){return t._firestoreClient||Cc(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}(e),r=new Bc(e);return function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new qn(jn.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query),dc(n,t._query).then((n=>new Vc(e,r,t,n)))}function qc(t){return qc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qc(t)}function $c(){$c=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function h(t,e,n,r){var s=e&&e.prototype instanceof y?e:y,o=Object.create(s.prototype),a=new N(r||[]);return i(o,"_invoke",{value:S(t,n,a)}),o}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",f="suspendedYield",p="executing",g="completed",m={};function y(){}function v(){}function w(){}var b={};u(b,o,(function(){return this}));var E=Object.getPrototypeOf,T=E&&E(E(x([])));T&&T!==n&&r.call(T,o)&&(b=T);var I=w.prototype=y.prototype=Object.create(b);function _(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function C(t,e){function n(i,s,o,a){var c=l(t[i],t,s);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==qc(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,o,a)}),(function(t){n("throw",t,o,a)})):e.resolve(h).then((function(t){u.value=t,o(u)}),(function(t){return n("throw",t,o,a)}))}a(c.arg)}var s;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return s=s?s.then(i,i):i()}})}function S(e,n,r){var i=d;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===g){if("throw"===s)throw o;return{value:t,done:!0}}for(r.method=s,r.arg=o;;){var a=r.delegate;if(a){var c=A(a,r);if(c){if(c===m)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var u=l(e,n,r);if("normal"===u.type){if(i=r.done?g:f,u.arg===m)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=g,r.method="throw",r.arg=u.arg)}}}function A(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,A(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var s=l(i,e.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,m;var o=s.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function D(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(D,this),this.reset(!0)}function x(e){if(e||""===e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}throw new TypeError(qc(e)+" is not iterable")}return v.prototype=w,i(I,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:v,configurable:!0}),v.displayName=u(w,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,c,"GeneratorFunction")),t.prototype=Object.create(I),t},e.awrap=function(t){return{__await:t}},_(C.prototype),u(C.prototype,a,(function(){return this})),e.AsyncIterator=C,e.async=function(t,n,r,i,s){void 0===s&&(s=Promise);var o=new C(h(t,n,r,i),s);return e.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},_(I),u(I,c,"Generator"),u(I,o,(function(){return this})),u(I,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=x,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return a.type="throw",a.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,m):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:x(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}function zc(t,e,n,r,i,s,o){try{var a=t[s](o),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function Kc(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(t){zc(s,r,i,o,a,"next",t)}function a(t){zc(s,r,i,o,a,"throw",t)}o(void 0)}))}}new WeakMap,function(t,e=!0){xn="10.12.2",Lt(new E("firestore",((t,{instanceIdentifier:n,options:r})=>{const i=t.getProvider("app").getImmediate(),s=new _c(new Gn(t.getProvider("auth-internal")),new Yn(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new qn(jn.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Vr(t.options.projectId,e)}(i,n),i);return r=Object.assign({useFetchStreams:e},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),Vt(kn,"4.6.3",t),Vt(kn,"4.6.3","esm2017")}();var Hc=Pt({apiKey:"AIzaSyBj3EmeODzfrJYOV7XMepP3v1ZWgc767i8",authDomain:"openai-75c43.firebaseapp.com",projectId:"openai-75c43",storageBucket:"openai-75c43.appspot.com",messagingSenderId:"972256077227",appId:"1:972256077227:web:2735c614bc712d5f529eee",measurementId:"G-BCF1BM6S5P"}),Gc=(function(t=Ft()){const e=Rt(t=b(t),Fe);e.isInitialized()?e.getImmediate():function(t,e={}){const n=Rt(t,Fe);if(n.isInitialized()){const t=n.getImmediate();if(f(e,n.getOptions()))return t;throw ze.create("already-initialized")}n.initialize({options:e})}(t)}(Hc),function(t,e){const n="string"==typeof t?t:"(default)",r=Rt("object"==typeof t?t:Ft(),"firestore").getImmediate({identifier:n});if(!r._initialized){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=s())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]})("firestore");t&&function(t,e,n,r={}){var s;const o=(t=mc(t,vc))._getSettings(),a=`${e}:${n}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&Pn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=Nn.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[i(JSON.stringify({alg:"none",type:"JWT"})),i(JSON.stringify(o)),""].join(".")}(r.mockUserToken,null===(s=t._app)||void 0===s?void 0:s.options.projectId);const o=r.mockUserToken.sub||r.mockUserToken.user_id;if(!o)throw new qn(jn.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Nn(o)}t._authCredentials=new Hn(new zn(e,n))}}(r,...t)}return r}(Hc)),Qc=[],Wc=[];function Xc(){return(Xc=Kc($c().mark((function t(){var e,n,r,i,s;return $c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,jc(Tc(Gc,"questions"));case 3:if(e=t.sent,n=[],e.forEach((function(t){n.push(t.data())})),!(n.length<10)){t.next=9;break}return console.log("Error: Not enough questions available. Found ".concat(n.length,".")),t.abrupt("return",[]);case 9:for(r=[],i=new Set;r.length<15;)s=Math.floor(Math.random()*n.length),i.has(s)||(r.push(n[s]),i.add(s));return Qc=r,t.abrupt("return",r);case 16:return t.prev=16,t.t0=t.catch(0),console.error("Error fetching random questions:",t.t0),t.abrupt("return",[]);case 20:case"end":return t.stop()}}),t,null,[[0,16]])})))).apply(this,arguments)}function Yc(t){if(Qc.length>0&&t>=0&&t<Qc.length){var e=Qc[t],n=e["Question Text"],r=e.Options,i=e["Client Needs Area"];console.log(Qc[t]);var s=t+1,o=s+". "+n,a=s+" of "+Qc.length;document.getElementById("randomQuestion").textContent=o,document.getElementById("questionProgress").textContent=a,document.getElementById("category").textContent=i;var c=document.getElementById("optionsContainer");c.innerHTML="";var u=function(t){var e=(JSON.parse(localStorage.getItem("userResponses"))||[]).find((function(e){return e.questionId===t}));return e?e.response:null}(e.QuestionID);r.forEach((function(t,n){var r="option_".concat(s,"_").concat(n),i=document.createElement("input");if(i.setAttribute("type","radio"),i.setAttribute("id",r),i.setAttribute("name","options_".concat(s)),i.setAttribute("value",t),u&&u===t&&(i.checked=!0),Wc.some((function(t){return t.questionId===e.QuestionID}))){i.disabled=!0;var o=Qc[ru]["Correct Answer"],a=Qc[ru].Explanation,h=Qc[ru]["Incorrect Explanation 1"],l=Qc[ru]["Incorrect Explanation 2"],d=Qc[ru]["Incorrect Explanation 3"],f=document.getElementById("correctAnswer");u.response===o?(f.textContent="Correct!",f.style.color="green",f.innerHTML+='<br><span style="color: green">'.concat(a,"</span><br>"),f.innerHTML+='<span style="color: red">'.concat(h,"<br>").concat(l,"<br>").concat(d,"</span>")):(f.textContent="Incorrect!",f.style.color="red",f.innerHTML+='<br><span style="color: green">Correct Answer: '.concat(o,"</span>"),f.innerHTML+='<br><span style="color: green">'.concat(a,"</span><br>"),f.innerHTML+='<span style="color: red">'.concat(h,"<br>").concat(l,"<br>").concat(d,"</span>"))}else document.getElementById("correctAnswer").textContent="";var p=document.createElement("label");p.setAttribute("for",r),p.textContent=t,c.appendChild(i),c.appendChild(p),c.appendChild(document.createElement("br"))})),document.getElementById("hints").textContent="",document.getElementById("hints").dataset.hintIndex=0}}function Jc(){!function(){var t=document.querySelector('input[name="options_'.concat(ru+1,'"]:checked'));if(t){var e=t.value,n=Qc[ru].QuestionID,r=e===Qc[ru]["Correct Answer"],i=Wc.findIndex((function(t){return t.QuestionID===n}));-1!==i?(Wc[i].response=e,Wc[i].isCorrect=r):Wc.push({questionId:n,response:e,isCorrect:r}),console.log("User responses:",Wc),localStorage.setItem("userResponses",JSON.stringify(Wc)),document.querySelectorAll('input[name="options_'.concat(ru+1,'"]')).forEach((function(t){t.disabled=!0}))}}();var t=document.querySelector('input[name="options_'.concat(ru+1,'"]:checked'));if(t){var e=t.value,n=Qc[ru]["Correct Answer"],r=Qc[ru].Explanation,i=Qc[ru]["Incorrect Explanation 1"],s=Qc[ru]["Incorrect Explanation 2"],o=Qc[ru]["Incorrect Explanation 3"],a=document.getElementById("correctAnswer");e===n?(a.textContent="Correct!",a.style.color="green",a.innerHTML+='<br><span style="color: green">'.concat(r,"</span><br>"),a.innerHTML+='<span style="color: red">'.concat(i,"<br>").concat(s,"<br>").concat(o,"</span>")):(a.textContent="Incorrect!",a.style.color="red",a.innerHTML+='<br><span style="color: green">Correct Answer: '.concat(n,"</span>"),a.innerHTML+='<br><span style="color: green">'.concat(r,"</span><br>"),a.innerHTML+='<span style="color: red">'.concat(i,"<br>").concat(s,"<br>").concat(o,"</span>"))}else alert("Please select an answer.")}function Zc(){var t=Qc[ru]["Narrow Focus Hint"],e=Qc[ru]["General Hint"],n=document.getElementById("hints");n.dataset.hintIndex||(n.dataset.hintIndex=0);var r=parseInt(n.dataset.hintIndex);if(0===r&&t)n.textContent=t;else{if(1!==r||!e)return void alert("You have used all your hints.");n.textContent=e}n.dataset.hintIndex=r+1}function tu(){document.getElementById("testContent").style.display="none",document.getElementById("endTestMessage").style.display="block";var t,e=(t=0,Wc.forEach((function(e){e.isCorrect&&t++})),t),n=document.querySelector("#endTestMessage p:nth-child(2)");n.textContent="".concat(e,"/").concat(15),n.style.color="green"}(function(){return Xc.apply(this,arguments)})().then((function(){Yc(0)}));var eu,nu,ru=0;document.addEventListener("DOMContentLoaded",(function(){var t=document.getElementById("nextButton"),e=document.getElementById("previousButton"),n=document.getElementById("submitAnswer"),r=document.getElementById("getHints"),i=document.getElementById("endTestBtn"),s=document.getElementById("pauseExamModal"),o=document.getElementById("pauseExam"),a=document.getElementById("elapsedTime"),c=document.getElementById("startNewExamBtn");t&&t.addEventListener("click",Kc($c().mark((function t(){return $c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:++ru>=Qc.length&&(ru=0),Yc(ru);case 1:case"end":return t.stop()}}),t)})))),e&&e.addEventListener("click",Kc($c().mark((function t(){return $c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:--ru<0&&(ru=Qc.length-1),Yc(ru);case 1:case"end":return t.stop()}}),t)})))),n&&n.addEventListener("click",Kc($c().mark((function t(){return $c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Jc();case 1:case"end":return t.stop()}}),t)})))),r&&r.addEventListener("click",Kc($c().mark((function t(){return $c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Zc();case 1:case"end":return t.stop()}}),t)})))),i&&i.addEventListener("click",Kc($c().mark((function t(){var e;return $c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=su(iu),a.textContent="Elapsed Time: "+e,$("#endModal").modal("hide"),clearInterval(eu),iu=0,document.getElementById("timer").textContent=su(iu),tu();case 5:case"end":return t.stop()}}),t)})))),s&&s.addEventListener("click",Kc($c().mark((function t(){return $c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:$("#pauseModal").modal("hide"),document.getElementById("testContent").style.display="none",document.getElementById("pauseTextMessage").style.display="block",cu();case 4:case"end":return t.stop()}}),t)})))),o&&o.addEventListener("click",Kc($c().mark((function t(){return $c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:document.getElementById("testContent").style.display="block",document.getElementById("pauseTextMessage").style.display="none",ou();case 3:case"end":return t.stop()}}),t)})))),c&&c.addEventListener("click",Kc($c().mark((function t(){return $c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:window.location.reload();case 1:case"end":return t.stop()}}),t)})))),ou(),$("#pauseButton").on("click",(function(){cu()})),$("#popoverButton").popover({title:"Settings",content:'\n                <div class="container-fluid">\n                    <div class="row">\n                        <div class="col">\n                            <h6>Font Size</h6>\n                            <button type="button" class="btn btn-outline-primary btn-sm mr-1"><i class="fas fa-search-minus"></i></button>\n                            <button type="button" class="btn btn-outline-primary btn-sm mr-1"><i class="fas fa-font"></i></button>\n                            <button type="button" class="btn btn-outline-primary btn-sm"><i class="fas fa-search-plus"></i></button>\n                        </div>\n                    </div>\n                    <div class="row mt-2">\n                        <div class="col">\n                            <h6>Color Theme</h6>\n                            <button type="button" class="btn btn-outline-light btn-sm mr-1">White</button>\n                            <button type="button" class="btn btn-outline-dark btn-sm mr-1">Black</button>\n                            <button type="button" class="btn btn-outline-secondary btn-sm">Sepia</button>\n                        </div>\n                    </div>\n                    <div class="row mt-2">\n                        <div class="col">\n                            <h6>Confirm Answer Omission</h6>\n                            <div class="custom-control custom-switch">\n                                <input type="checkbox" class="custom-control-input" id="toggleSwitch">\n                                <label class="custom-control-label" for="toggleSwitch">Turn on or off</label>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            ',html:!0,placement:"bottom"})}));var iu=0;function su(t){var e=Math.floor(t/3600),n=Math.floor(t%3600/60),r=t%60;return"".concat(e<10?"0"+e:e,":").concat(n<10?"0"+n:n,":").concat(r<10?"0"+r:r)}function ou(){nu=Date.now()-1e3*iu,eu=setInterval(au,1e3)}function au(){var t=Date.now();iu=Math.floor((t-nu)/1e3),document.getElementById("timer").textContent=su(iu)}function cu(){clearInterval(eu)}})();